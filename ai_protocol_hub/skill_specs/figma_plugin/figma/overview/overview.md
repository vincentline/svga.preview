# Figma 插件开发概述

## 插件基本概念

插件是由社区创建的程序或应用程序，用于扩展 Figma 编辑器的功能。插件在文件中运行并执行一个或多个操作。用户和组织可以利用插件来自定义他们的体验并创建更高效的工作流程。

插件使用两种常见的 Web 开发语言创建：JavaScript 和 HTML。开发插件需要了解这些语言。您将在 JavaScript 中编写插件的功能，并使用 HTML 构建用户界面 (UI)。

## 插件工作原理

插件通过专用的 Plugin API 与 Figma 的编辑器交互。它们还可以利用大多数现代浏览器中可用的外部 Web API。您可以构建在用户调用时立即运行的插件，或需要用户通过自定义 UI 输入信息的插件。

### API 访问

Plugin API 支持对 Figma 编辑器的读写访问，允许开发者查看、创建和修改文件内容。您可以通过 `figma` 全局对象访问大部分插件 API。

插件首先与文件内容交互。这是指存在于图层面板中的任何内容以及与属性面板中这些图层相关联的任何属性。插件可以查看和修改这些图层（或节点）的各个方面，如颜色、位置、层次结构、文本等。

Figma 文件是动态加载的。这意味着页面仅在编辑器需要时才加载（例如，当用户导航到页面时）。插件必须使用异步 API 来访问当前查看页面之外的文件部分。

### 访问限制

插件访问存在一些限制：

1. **样式和组件**：Plugin API 只能访问当前文件中存在的样式、组件和实例，或通过 `importComponentByKeyAsync()` 等函数导入到文件中的样式、组件和实例。

2. **字体**：插件只能访问编辑器中可访问的字体，包括 Figma 的默认字体、共享的组织字体或存储在您计算机上的本地字体。Plugin API 只能访问通过 `loadFontAsync()` 加载的编辑器字体。

3. **文件元数据**：插件无法访问其他文件元数据，如文件的团队或位置、权限或与该文件关联的任何评论。这包括该文件的版本历史记录。您可以通过 Figma 的 REST API 获取对文件这些方面的读取访问权限。

## 插件行为差异

插件的行为可能会因用户正在执行的操作而异，例如他们是否在 Figma 设计模式、开发模式、FigJam、Figma Slides 或 Figma Buzz 中。在开发模式下运行的插件有一些重要的差异需要了解。

## 文档结构

Figma 中的每个文件都由节点树组成，每个文件的根节点是 `DocumentNode`。`DocumentNode` 是您访问和浏览文件内容的方式。

在 Figma 设计或 FigJam 文件中，每个 `DocumentNode` 都会有表示该 Figma 文件中每个页面的 `PageNode`。在 Figma Slides 或 Figma Buzz 的情况下，只有一个 `PageNode`。每个浏览器选项卡只有一个 `DocumentNode`，其每个子节点都是 `PageNode`。由于 Figma 文件是动态加载的，并非所有 `PageNode` 都会立即加载并可供插件使用。开发者可以使用 Plugin API 根据需要加载和遍历其他 `PageNode`。

`DocumentNode` 可以有任意数量的子节点。从 `DocumentNode` 派生的每个子树都表示画布上的图层或对象。Figma 中有特定的节点或类用于不同类型的图层 — 如框架、组件、矢量和矩形。

节点具有与其关联的许多属性。有些属性是全局的，有些是节点之间共享的，有些是特定于特定节点类型的。

## 插件运行机制

### 异步特性

Plugin API 设计为异步使用，Figma 鼓励插件开发者利用 Plugin API 提供的异步方法。Figma 插件的许多关键操作，如加载页面和处理字体和图像，都是异步的。

### 基于浏览器

Figma 主要是基于浏览器的软件，这意味着它可以在所有完整的桌面操作系统（MacOS、Windows、Linux 等）以及 Chrome OS 上运行。

与 Figma 一样，插件由 Web 技术提供支持。Plugin API 的一部分在 `<iframe>` 中运行，这意味着您还可以访问浏览器 API。这包括发出网络请求、打开本地文件以及使用 `<canvas>`、WebGL 和 WebAssembly 等功能。

### 用户操作

插件在文件中运行并执行一个或多个用户操作。这些用户操作通常是短暂的，必须由用户启动。

用户一次只能运行一个插件和一个操作。无法构建在后台运行的插件。

## 插件 UI

插件还可以打开一个作为 `<iframe>` 的模态对话框，并在该 `<iframe>` 内写入 HTML、CSS 和 JavaScript。您可以在该模态对话框内创建任何您想要的 UI。

能够从与 Figma 设计系统匹配的组件库中获取组件可以显著加快插件开发速度，并帮助您创建与 Figma 自己的 UI 镜像的 UI。虽然我们没有将这些组件作为核心 Figma Plugin API 的一部分提供，但 Figma 员工和插件开发者 Tom Lowry 已经整理了一个 React 组件库，您可以使用它来构建插件的 UI。

## 插件参数

开发者可以创建带有参数的插件，允许插件通过快速操作菜单接受用户输入。

添加参数意味着在许多情况下您不需要构建自定义 UI。它还为插件用户提供了简化的体验，他们可以使用键盘直接从快速操作菜单运行插件。

## 重新启动插件

构建插件时，您可以选择在 Figma 的 UI 中创建按钮，允许用户重新启动您的插件。这使得多次运行插件变得更加容易，并允许协作者从同一个文件重新启动插件。您可以使用 `setRelaunchData()` 函数来实现这一点。

## 插件管理

### 支持

Figma 不为第三方应用程序提供支持。作为插件的开发者，您有责任协助插件用户解决技术问题。提交插件以供批准时，您需要添加支持联系人。这可以是用户可以联系的电子邮件地址，或指向网站或帮助中心的链接。

### 版本控制

一旦 Figma 批准您的插件，您不需要为进一步的审查提交插件。这意味着您可以立即发布任何更新。您将能够在插件的版本历史记录中添加任何更改或更新的详细说明。如果您更改了插件的数据实践，您还可以更新插件的安全披露表单。当您发布更新时，Figma 将为每个用户更新插件。用户无法恢复到插件的先前版本。如果您需要回滚任何更改，您可以重新发布插件的早期版本。

### 分析

Figma 目前不提供任何关于插件使用或错误/崩溃报告的分析或报告。我们建议使用您自己的分析或崩溃报告服务来监控插件性能。Figma 将每周向插件开发者发送有关他们在 Figma 社区中获得的任何参与的通知。