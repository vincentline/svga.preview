# æ™®é€šMP4è§†é¢‘ç¼–è¾‘åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

ä¸ºæ™®é€šMP4æ¨¡å¼å¢åŠ æ—¶é—´è½´é‡æ˜ å°„(å˜é€Ÿ)æ ¸å¿ƒç¼–è¾‘èƒ½åŠ›,ä½¿é¡¹ç›®æˆä¸ºAIGCè§†é¢‘åˆ°å®¢æˆ·ç«¯åŠ¨ç”»æ ¼å¼çš„å®Œæ•´è½¬æ¢å·¥å…·é“¾ã€‚

**è®¾è®¡ç›®æ ‡**:
- åœ¨ç°æœ‰æ™®é€šMP4æ¨¡å¼åŸºç¡€ä¸Šå¢å¼ºé¢„å¤„ç†èƒ½åŠ›
- æ‰€æœ‰ç¼–è¾‘æ“ä½œåœ¨å¯¼å‡ºå‰å®Œæˆ,å¯¼å‡ºæ—¶åº”ç”¨ç¼–è¾‘ç»“æœ
- èšç„¦AIç”ŸæˆçŸ­è§†é¢‘çš„é€Ÿåº¦è°ƒæ•´éœ€æ±‚
- ä»…ä¿ç•™å˜é€ŸåŠŸèƒ½,æä¾›å¸§çº§ç²¾åº¦çš„é€Ÿåº¦æ§åˆ¶

---

## ä¸€ã€æ—¶é—´è½´é‡æ˜ å°„åŠŸèƒ½(å˜é€Ÿ)

### åŠŸèƒ½å®šä½

å…è®¸ç”¨æˆ·é€šè¿‡åœ¨æ—¶é—´è½´ä¸Šæ·»åŠ å…³é”®å¸§(Kå¸§)èŠ‚ç‚¹æ§åˆ¶è§†é¢‘æ’­æ”¾é€Ÿåº¦,å®ç°ç²¾ç¡®åˆ°å¸§çš„é€Ÿåº¦å˜åŒ–,æ— éœ€è¡¥å¸§ã€‚

**æ ¸å¿ƒä½¿ç”¨åœºæ™¯**: AIç”Ÿæˆçš„çŸ­è§†é¢‘(5ç§’å†…)é€Ÿåº¦è°ƒæ•´å›°éš¾,éœ€è¦å¸§çº§åˆ«çš„ç²¾ç¡®é€Ÿåº¦æ§åˆ¶ã€‚

### äº¤äº’è®¾è®¡

#### å…¥å£ä¸å¸ƒå±€

```
åº•éƒ¨æµ®å±‚æ–°å¢æŒ‰é’®:ã€Œå˜é€Ÿã€
ç‚¹å‡»å:æµ®å±‚å¤–å·¦ä¾§æ˜¾ç¤ºæ—¶é—´è½´ç¼–è¾‘å™¨
```

| ä½ç½® | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| æµ®å±‚å¤–å·¦å¯¹é½ | æ—¶é—´è½´ç¼–è¾‘å™¨ | å›ºå®šå®½åº¦400px,ç‹¬ç«‹äºä¾§è¾¹æ  |
| æ—¶é—´è½´ä¸Š | Kå¸§èŠ‚ç‚¹æ ‡è®° | é»‘è‰²/è“è‰²ç«–çº¿,å¯ç‚¹å‡»/æ‹–æ‹½ |
| æ—¶é—´è½´ä¸‹æ–¹ | æ“ä½œæŒ‰é’® | å–æ¶ˆ / ç¡®å®š |
| Kå¸§èŠ‚ç‚¹å¼¹çª— | é€Ÿåº¦å€ç‡è°ƒæ•´å™¨ | ç‚¹å‡»èŠ‚ç‚¹å¼¹å‡ºé€Ÿåº¦è®¾ç½®æ»‘å— |

#### æ—¶é—´è½´Kå¸§ç¼–è¾‘å™¨è®¾è®¡(åŸºäºFigmaè®¾è®¡ç¨¿)

**è§†è§‰ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ—¶é—´è½´ 400px Ã— 16px]  [å–æ¶ˆ] [ç¡®å®š]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘ å·¦å¯¹é½,åœ¨æµ®å±‚å¤–é¢

æ—¶é—´è½´è¯¦ç»†ç»“æ„:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”‚         â”‚                â”‚              â”‚
0å¸§      K1(60å¸§)       K2(100å¸§)      150å¸§
é»‘è‰²     è“è‰²(å¯æ‹–)      è“è‰²(å¯æ‹–)     é»‘è‰²
1px      11pxå®½          11pxå®½         1px
å›ºå®š     å¯ç§»åŠ¨          å¯ç§»åŠ¨         å›ºå®š

åº•è‰²: #F3F3F3 (æµ…ç°è‰²èƒŒæ™¯)
èµ·ç‚¹/ç»ˆç‚¹èŠ‚ç‚¹: #333333 (é»‘è‰²,å›ºå®š)
å¯æ‹–æ‹½Kå¸§èŠ‚ç‚¹: #00B4FF (è“è‰²,å®½11px)
```

**åƒç´ -å¸§å·æ˜ å°„**:
```javascript
// æ—¶é—´è½´æ€»å®½åº¦: 400px
// è§†é¢‘æ€»å¸§æ•°: 150å¸§
// ç²¾åº¦: 400 Ã· 150 = 2.67px/å¸§

// å¸§å· â†’ åƒç´ ä½ç½®
function frameToPixel(frameIndex) {
  return (frameIndex / totalFrames) * 400;
}

// åƒç´ ä½ç½® â†’ å¸§å·
function pixelToFrame(pixelX) {
  return Math.round((pixelX / 400) * totalFrames);
}
```

**èŠ‚ç‚¹æ“ä½œ**:
- **æ·»åŠ Kå¸§**: ç‚¹å‡»æ—¶é—´è½´ç©ºç™½å¤„ â†’ å¼¹å‡ºé€Ÿåº¦é€‰æ‹©å™¨ â†’ æ’å…¥è“è‰²èŠ‚ç‚¹
- **è°ƒæ•´Kå¸§ä½ç½®**: æ‹–æ‹½è“è‰²æ‰‹æŸ„(11pxå®½) â†’ å·¦å³ç§»åŠ¨ â†’ å¸é™„åˆ°å¸§ä½ç½®
- **è°ƒæ•´Kå¸§é€Ÿåº¦**: ç‚¹å‡»èŠ‚ç‚¹ â†’ å¼¹å‡ºé€Ÿåº¦æ»‘å— â†’ è°ƒæ•´å€ç‡(0.5x - 5.0x)
- **åˆ é™¤Kå¸§**: ç‚¹å‡»èŠ‚ç‚¹ â†’ é€Ÿåº¦é¢æ¿ä¸­æœ‰åˆ é™¤æŒ‰é’®
- **å›ºå®šèŠ‚ç‚¹**: èµ·ç‚¹(0å¸§)å’Œç»ˆç‚¹(150å¸§)å›ºå®š,ä¸å¯åˆ é™¤,ä»…é€Ÿåº¦å¯è°ƒ

#### æ—¶é—´è½´ç¼–è¾‘å™¨UIå¸ƒå±€

**ä¸»ç•Œé¢(æµ®å±‚å¤–å·¦å¯¹é½)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´è½´(400px Ã— 16px)  [å–æ¶ˆ] [ç¡®å®š]        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  â”‚     â”‚           â”‚                    â”‚    â”‚
â”‚  0    60å¸§       100å¸§                150å¸§  â”‚
â”‚  1.0x  2.0x       0.5x                1.0x  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Kå¸§é€Ÿåº¦è°ƒæ•´å¼¹çª—(ç‚¹å‡»èŠ‚ç‚¹å¼¹å‡º)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…³é”®å¸§é€Ÿåº¦è®¾ç½®      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä½ç½®: 60å¸§ (2.0s)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€Ÿåº¦å€ç‡:           â”‚
â”‚ [â”â”â”â”â—â”â”â”â”] 2.0x   â”‚
â”‚ 0.5x      5.0x      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¿«æ·é€‰æ‹©:           â”‚
â”‚ [0.5x] [1.0x]       â”‚
â”‚ [2.0x] [5.0x]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [åˆ é™¤Kå¸§] [ç¡®å®š]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ—¶é•¿é¢„ä¼°æ˜¾ç¤º(æ—¶é—´è½´ä¸Šæ–¹)**:
```
åŸå§‹: 5.0s â†’ åº”ç”¨å: 3.2s (-36%)
```

### æ•°æ®ç»“æ„

```javascript
speedRemapConfig: {
  enabled: false,              // æ˜¯å¦å¯ç”¨å˜é€Ÿ
  keyframes: [                 // å…³é”®å¸§æ•°ç»„(æŒ‰å¸§å·æ’åº)
    { frame: 0, speed: 1.0, draggable: false },    // èµ·ç‚¹å›ºå®š
    { frame: 60, speed: 2.0, draggable: true },    // å¯æ‹–æ‹½Kå¸§
    { frame: 100, speed: 0.5, draggable: true },   // å¯æ‹–æ‹½Kå¸§
    { frame: 150, speed: 1.0, draggable: false }   // ç»ˆç‚¹å›ºå®š
  ],
  interpolation: 'linear',     // æ’å€¼æ–¹å¼: 'linear'(çº¿æ€§) | 'easeInOut'(å¹³æ»‘)
  outputDuration: 3.2,         // é¢„è®¡è¾“å‡ºæ—¶é•¿(ç§’)
  outputTotalFrames: 96,       // é¢„è®¡è¾“å‡ºæ€»å¸§æ•°
  originalTotalFrames: 150,    // åŸå§‹æ€»å¸§æ•°
  originalDuration: 5.0,       // åŸå§‹æ—¶é•¿(ç§’)
  fps: 30                      // å¸§ç‡
}
```

### å¤„ç†æµç¨‹

#### å˜é€Ÿåº”ç”¨æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·ç‚¹å‡»å˜é€ŸæŒ‰é’®] --> B[æ˜¾ç¤ºæ›²çº¿ç¼–è¾‘å™¨]
    B --> C[ç”¨æˆ·æ·»åŠ /è°ƒæ•´å…³é”®å¸§]
    C --> D[å®æ—¶è®¡ç®—è¾“å‡ºæ—¶é•¿]
    D --> E{ç‚¹å‡»åº”ç”¨å˜é€Ÿ}
    E --> F[ä¿å­˜å˜é€Ÿé…ç½®]
    F --> G[æ’­æ”¾å™¨æŒ‰å˜é€Ÿæ›²çº¿æ’­æ”¾]
    G --> H[å¯¼å‡ºæ—¶é‡æ˜ å°„æ—¶é—´è½´]
    
    E --> I{ç‚¹å‡»é‡ç½®}
    I --> J[æ¢å¤1.0xåŒ€é€Ÿ]
    J --> B
```

#### é€Ÿåº¦æ’å€¼è®¡ç®—

**å…³é”®å¸§ä¹‹é—´çš„é€Ÿåº¦æ’å€¼(åŸºäºå¸§å·)**:

**çº¿æ€§æ’å€¼**:
```javascript
// ç»™å®šä¸¤ä¸ªå…³é”®å¸§ K1(frame1, speed1) å’Œ K2(frame2, speed2)
// è®¡ç®—ä¸­é—´å¸§ frame âˆˆ [frame1, frame2] çš„é€Ÿåº¦

function getSpeedAtFrame(frame, keyframes) {
  // æ‰¾åˆ°frameæ‰€åœ¨çš„ä¸¤ä¸ªå…³é”®å¸§åŒºé—´
  for (let i = 0; i < keyframes.length - 1; i++) {
    const k1 = keyframes[i];
    const k2 = keyframes[i + 1];
    
    if (frame >= k1.frame && frame <= k2.frame) {
      // çº¿æ€§æ’å€¼
      const ratio = (frame - k1.frame) / (k2.frame - k1.frame);
      return k1.speed + (k2.speed - k1.speed) * ratio;
    }
  }
  return 1.0; // é»˜è®¤é€Ÿåº¦
}

// ç¤ºä¾‹:
// K1: ç¬¬60å¸§ - 1.0x
// K2: ç¬¬90å¸§ - 2.0x
// ç¬¬75å¸§çš„é€Ÿåº¦ = 1.0 + (2.0-1.0) Ã— (75-60)/(90-60) = 1.5x
```

**å¹³æ»‘æ’å€¼(Ease-In-Out,å¯é€‰)**:
```javascript
function getSpeedAtFrameSmooth(frame, keyframes) {
  // æ‰¾åˆ°åŒºé—´å:
  const ratio = (frame - k1.frame) / (k2.frame - k1.frame);
  // å¹³æ»‘å‡½æ•°(Sæ›²çº¿)
  const smoothRatio = ratio * ratio * (3 - 2 * ratio);
  return k1.speed + (k2.speed - k1.speed) * smoothRatio;
}
```

#### æ—¶é—´è½´é‡æ˜ å°„ç®—æ³•

**ç›®æ ‡**ï¼šæ ¹æ®é€Ÿåº¦æ›²çº¿ï¼Œå°†åŸè§†é¢‘çš„æ¯ä¸€å¸§æ˜ å°„åˆ°æ–°çš„è¾“å‡ºæ—¶é—´è½´ã€‚

**åŸç†**ï¼š
```
åŸè§†é¢‘æ—¶é—´çº¿: t_orig (0 ~ originalDuration)
è¾“å‡ºæ—¶é—´çº¿: t_out (0 ~ outputDuration)

åœ¨åŸè§†é¢‘æ—¶é—´ t_orig æ—¶ï¼š
  é€Ÿåº¦ = speed(t_orig)
  dt_out = dt_orig / speed     // é€Ÿåº¦å¿«ï¼Œè¾“å‡ºæ—¶é—´å¢é•¿æ…¢ï¼›é€Ÿåº¦æ…¢ï¼Œè¾“å‡ºæ—¶é—´å¢é•¿å¿«
```

**è®¡ç®—è¾“å‡ºæ—¶é•¿**ï¼š
```
å°†åŸæ—¶é—´è½´åˆ†æˆ N æ®µï¼ˆå¦‚æ¯ 0.01 ç§’ï¼‰
å¯¹æ¯æ®µï¼š
  speed_i = æ’å€¼è®¡ç®—çš„é€Ÿåº¦
  dt_out_i = dt_orig / speed_i
outputDuration = Î£ dt_out_i
```

**å¸§æ˜ å°„å…³ç³»è¡¨**ï¼š
å¯¼å‡ºæ—¶é¢„å…ˆè®¡ç®—æ˜ å°„è¡¨ï¼Œé¿å…å®æ—¶è®¡ç®—ï¼š
```
outputFrameMap = [
  { outputFrame: 0, originalTime: 0.0 },
  { outputFrame: 1, originalTime: 0.033 },
  { outputFrame: 2, originalTime: 0.05 },   // é€Ÿåº¦2xæ—¶ï¼ŒåŸè§†é¢‘èµ°å¾—å¿«
  { outputFrame: 3, originalTime: 0.067 },
  ...
]
```

#### æ’­æ”¾å™¨è¡Œä¸ºå˜åŒ–

**æ ¸å¿ƒåŸåˆ™**: è¿›åº¦æ¡å§‹ç»ˆæ˜¾ç¤ºåŸå§‹å¸§æ•°,æ»‘å—ç§»åŠ¨é€Ÿåº¦ä¼šå˜åŒ–ã€‚

**æ’­æ”¾æ—¶çš„è¡¨ç°**:
```
å‡è®¾å…³é”®å¸§é…ç½®:
K1: ç¬¬0å¸§   - 1.0x
K2: ç¬¬60å¸§  - 2.0x  
K3: ç¬¬150å¸§ - 1.0x

è¿›åº¦æ¡æ˜¾ç¤º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ğŸ‘‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‹ â”‚  â† æ»‘å—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  0å¸§       60å¸§              150å¸§

æ»‘å—ç§»åŠ¨é€Ÿåº¦:
- 0-60å¸§åŒºé—´: æ­£å¸¸é€Ÿåº¦(1.0x)
- 60-150å¸§åŒºé—´: æ»‘å—è·‘å¾—å¿«(2.0x,è§†è§‰ä¸Šå¿«è¿›)
- ç„¶åæ¢å¤æ­£å¸¸é€Ÿåº¦

ç”¨æˆ·æ„ŸçŸ¥:
âœ… è¿›åº¦æ¡é•¿åº¦ä¸å˜(è¿˜æ˜¯150å¸§çš„åˆ»åº¦)
âœ… æ»‘å—ç§»åŠ¨é€Ÿåº¦ä¼šå˜åŒ–(å¿«é€ŸåŒºåŸŸæ»‘å—è·‘å¾—å¿«)
âœ… æ‹–åŠ¨è¿›åº¦æ¡æ—¶,å®šä½çš„æ˜¯"åŸå§‹ç¬¬å‡ å¸§"
âŒ ä¸ä¼šå‡ºç°"è¿›åº¦æ¡å˜æ…¢"çš„æƒ…å†µ
```

**æŠ€æœ¯å®ç°**:
```javascript
// æ’­æ”¾å¾ªç¯
function renderLoop(timestamp) {
  // 1. æ ¹æ®å½“å‰å¸§å·è·å–é€Ÿåº¦å€ç‡
  const currentSpeed = getSpeedAtFrame(currentFrame);
  
  // 2. è®¡ç®—ç›®æ ‡å¸§æ—¶é—´(åº”ç”¨é€Ÿåº¦)
  const targetFrameTime = (1000 / fps) / currentSpeed;
  
  // 3. åˆ¤æ–­æ˜¯å¦éœ€è¦å‰è¿›åˆ°ä¸‹ä¸€å¸§
  if (elapsed >= targetFrameTime) {
    currentFrame++; // å¸§å·æ­£å¸¸é€’å¢
    renderFrame(currentFrame); // æ¸²æŸ“å½“å‰å¸§
    
    // 4. æ›´æ–°è¿›åº¦æ¡(æ˜¾ç¤ºåŸå§‹å¸§å·)
    progress = (currentFrame / totalFrames) * 100;
  }
  
  requestAnimationFrame(renderLoop);
}
```

**æ‹–åŠ¨è¿›åº¦æ¡**:
- æ‹–åŠ¨åˆ°50% â†’ å®šä½åˆ°ç¬¬75å¸§(åŸå§‹å¸§å·)
- ä¸å—é€Ÿåº¦å½±å“,å§‹ç»ˆç²¾ç¡®å®šä½

#### å¯¼å‡ºæ—¶å¤„ç†

**å¯¼å‡ºæµç¨‹(åº”ç”¨å˜é€Ÿ)**:
```javascript
async function exportWithSpeedRemap() {
  const { keyframes, fps, originalTotalFrames } = speedRemapConfig;
  
  // 1. è®¡ç®—è¾“å‡ºæ€»å¸§æ•°
  const outputDuration = calculateOutputDuration(keyframes, fps, originalTotalFrames);
  const outputTotalFrames = Math.ceil(outputDuration * fps);
  
  // 2. é¢„å…ˆæ„å»ºå¸§æ˜ å°„è¡¨(æå‡æ€§èƒ½)
  const frameMap = buildFrameMap(keyframes, fps, outputTotalFrames);
  
  // 3. æå–å¹¶å¯¼å‡ºå¸§
  for (let outFrame = 0; outFrame < outputTotalFrames; outFrame++) {
    // æŸ¥è¡¨è·å–åŸå§‹å¸§å·
    const originalFrame = frameMap[outFrame];
    
    // è·³è½¬åˆ°åŸå§‹å¸§å¹¶æå–
    await seekToFrame(originalFrame);
    const frameData = captureFrame();
    
    // æ·»åŠ åˆ°è¾“å‡ºåºåˆ—
    outputFrames.push(frameData);
  }
  
  // 4. ç¼–ç å¯¼å‡º
  encodeToFormat(outputFrames);
}
```

**å¸§æ˜ å°„è¡¨æ„å»º**:
```javascript
function buildFrameMap(keyframes, fps, outputTotalFrames) {
  const frameMap = [];
  let originalTime = 0;
  
  for (let outFrame = 0; outFrame < outputTotalFrames; outFrame++) {
    // å½“å‰è¾“å‡ºå¸§å¯¹åº”çš„åŸå§‹æ—¶é—´
    frameMap[outFrame] = Math.floor(originalTime * fps);
    
    // è®¡ç®—ä¸‹ä¸€å¸§çš„åŸå§‹æ—¶é—´å¢é‡
    const speed = getSpeedAtFrame(frameMap[outFrame], keyframes);
    const dt = (1 / fps) * speed; // é€Ÿåº¦å¿«,åŸå§‹æ—¶é—´èµ°å¾—å¿«
    originalTime += dt;
  }
  
  return frameMap;
}

// ç¤ºä¾‹æ˜ å°„è¡¨:
// frameMap = [
//   0,   // è¾“å‡ºç¬¬0å¸§ â†’ åŸå§‹ç¬¬0å¸§
//   1,   // è¾“å‡ºç¬¬1å¸§ â†’ åŸå§‹ç¬¬1å¸§ (1.0x)
//   3,   // è¾“å‡ºç¬¬2å¸§ â†’ åŸå§‹ç¬¬3å¸§ (2.0x,è·³å¸§)
//   5,   // è¾“å‡ºç¬¬3å¸§ â†’ åŸå§‹ç¬¬5å¸§
//   ...
// ]
```

**æ— è¡¥å¸§å¤„ç†**:
- é€Ÿåº¦ > 1.0x: è·³è¿‡éƒ¨åˆ†åŸå§‹å¸§(ä¸¢å¸§)
- é€Ÿåº¦ < 1.0x: é‡å¤ä½¿ç”¨åŸå§‹å¸§(å¤å¸§)
- ä¸ç”Ÿæˆæ–°çš„ä¸­é—´å¸§,ä¿æŒåŸå§‹ç”»è´¨

### æŠ€æœ¯è¦ç‚¹

**1. èŠ‚ç‚¹æ‹–æ‹½çº¦æŸ**:
```javascript
// æ‹–æ‹½è¾¹ç•Œæ£€æµ‹
function validateNodePosition(draggedNode, newFrame) {
  const index = keyframes.indexOf(draggedNode);
  const prevFrame = keyframes[index - 1]?.frame || 0;
  const nextFrame = keyframes[index + 1]?.frame || totalFrames;
  
  // ä¸å¯è¶…è¿‡ç›¸é‚»èŠ‚ç‚¹
  if (newFrame <= prevFrame || newFrame >= nextFrame) {
    return false;
  }
  
  // é¦–å°¾èŠ‚ç‚¹å›ºå®š
  if (index === 0 || index === keyframes.length - 1) {
    return false;
  }
  
  return true;
}

// é€Ÿåº¦èŒƒå›´é™åˆ¶
const MIN_SPEED = 0.1;  // æœ€å°0.1å€é€Ÿ
const MAX_SPEED = 12;   // æœ€å¤§12å€é€Ÿ
```

**2. å¸é™„åŠŸèƒ½(å¯é€‰)**:
```javascript
// æ‹–æ‹½æ—¶å¸é™„åˆ°æ¯5å¸§
function snapToFrame(frame, snapInterval = 5) {
  return Math.round(frame / snapInterval) * snapInterval;
}
```

**3. æ—¶é—´è½´æ¸²æŸ“å®ç°**:
```javascript
// æ¸²æŸ“Kå¸§èŠ‚ç‚¹
function renderKeyframes(keyframes) {
  keyframes.forEach(kf => {
    const x = frameToPixel(kf.frame);
    const color = kf.draggable ? '#00B4FF' : '#333333';
    const width = kf.draggable ? 11 : 1;
    
    // åˆ›å»ºDOMèŠ‚ç‚¹æˆ–Canvasç»˜åˆ¶
    createMarker(x, color, width, kf);
  });
}
```

**4. è¾“å‡ºæ—¶é•¿è®¡ç®—**:
```javascript
// æ ¹æ®é€Ÿåº¦æ›²çº¿è®¡ç®—è¾“å‡ºæ€»æ—¶é•¿
function calculateOutputDuration(keyframes, fps, totalFrames) {
  let outputDuration = 0;
  
  for (let frame = 0; frame < totalFrames - 1; frame++) {
    const speed = getSpeedAtFrame(frame, keyframes);
    const frameDuration = (1 / fps) / speed; // å½“å‰å¸§æ—¶é•¿
    outputDuration += frameDuration;
  }
  
  return outputDuration;
}

// ç¤ºä¾‹:
// åŸå§‹150å¸§,30fps â†’ 5ç§’
// åº”ç”¨2å€é€Ÿ â†’ è¾“å‡º2.5ç§’
```

**5. æ€§èƒ½ä¼˜åŒ–**:
- æ‹–æ‹½æ—¶ä½¿ç”¨èŠ‚æµ(throttle 50ms)
- ä»…åœ¨é‡Šæ”¾é¼ æ ‡æ—¶é‡æ–°è®¡ç®—è¾“å‡ºæ—¶é•¿
- å¯¼å‡ºæ—¶é¢„å…ˆæ„å»ºå¸§æ˜ å°„è¡¨,é¿å…å®æ—¶è®¡ç®—

**6. äº¤äº’åé¦ˆ**:
```javascript
// é¼ æ ‡æ‚¬åœKå¸§æ—¶æ˜¾ç¤ºæç¤º
function showTooltip(kf) {
  return `
    å¸§å·: ${kf.frame}
    æ—¶é—´: ${(kf.frame / fps).toFixed(2)}s
    é€Ÿåº¦: ${kf.speed.toFixed(1)}x
  `;
}
```

---

## äºŒã€åŠŸèƒ½æ•´åˆä¸äº¤äº’è§„èŒƒ

### åº•éƒ¨æµ®å±‚æŒ‰é’®å¸ƒå±€

**æ–°å¢æŒ‰é’®ä½ç½®**(å»ºè®®å¸ƒå±€):
```
[æ’­æ”¾] [è¿›åº¦æ¡] | [èƒŒæ™¯è‰²] [ç¼©æ”¾] [1:1] | [å˜é€Ÿ] | [å¯¼å‡ºGIF] [è½¬åŒé€šé“MP4] [è½¬SVGA]
```

æŒ‰é’®åˆ†ç»„é€»è¾‘:
1. å·¦ä¾§:æ’­æ”¾æ§åˆ¶
2. ä¸­é—´å·¦:è§†å›¾æ§åˆ¶
3. ä¸­é—´å³:ç¼–è¾‘åŠŸèƒ½(æ–°å¢)
4. å³ä¾§:å¯¼å‡ºè½¬æ¢

**æ³¨æ„**:å˜é€ŸåŠŸèƒ½ä½¿ç”¨ç‹¬ç«‹çš„æ—¶é—´è½´ç¼–è¾‘å™¨(æµ®å±‚å¤–å·¦å¯¹é½),ä¸å ç”¨å³ä¾§ä¾§è¾¹æ ã€‚

### å¯¼å‡ºæµç¨‹

```
åŸè§†é¢‘å¸§
  â†“
[1] æ ¹æ®å˜é€Ÿé…ç½®,é‡æ˜ å°„æ—¶é—´è½´ç”Ÿæˆè¾“å‡ºå¸§ç´¢å¼•
  â†“
[2] ç¼–ç ä¸ºç›®æ ‡æ ¼å¼(åŒé€šé“MP4/SVGA/GIF)
```

### çŠ¶æ€æç¤º

**åº”ç”¨ç¼–è¾‘åçš„è§†è§‰åé¦ˆ**:
- åº•éƒ¨æµ®å±‚æŒ‰é’®ä¸Šå¢åŠ æ ‡è®°(å¦‚:å˜é€Ÿâœ“)
- æ–‡ä»¶ä¿¡æ¯åŒºæ˜¾ç¤º:
  - åŸå§‹æ—¶é•¿:00:05.0
  - å˜é€Ÿåæ—¶é•¿:00:03.2

**å¯¼å‡ºæç¤º**:
å¯¼å‡ºå‰å¼¹çª—ç¡®è®¤:
```
å³å°†å¯¼å‡ºçš„è§†é¢‘å·²åº”ç”¨ä»¥ä¸‹ç¼–è¾‘:
âœ“ å˜é€Ÿ: åŒ…å« 3 ä¸ªå…³é”®å¸§

é¢„è®¡è¾“å‡ºæ—¶é•¿: 00:03.2
é¢„è®¡æ–‡ä»¶å¤§å°: ~1.8 MB

[ç¡®è®¤å¯¼å‡º] [å–æ¶ˆ]
```

---

## ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆæ€»ç»“

### å¤ç”¨ç°æœ‰èƒ½åŠ›

| åŠŸèƒ½ | å¤ç”¨æŠ€æœ¯ |
|------|----------|
| å˜é€Ÿ | æ—¶é—´è½´æ˜ å°„è¡¨ + å¸§è·³è½¬ |
| å¯¼å‡º | ffmpeg.wasmã€protobufç¼–ç ã€gif.js |
| å¸§æå– | åŒé€šé“MP4/SVGAçš„å¸§æå–é€»è¾‘ |

### æ–°å¢æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | èŒè´£ | ä»£ç ä½ç½®å»ºè®® |
|------|------|-------------|
| SpeedRemapEditor | Kå¸§æ—¶é—´è½´ç¼–è¾‘å™¨ | app.js æˆ–ç‹¬ç«‹ speed-remap-editor.js |
| EditingProcessor | ç¼–è¾‘é…ç½®åº”ç”¨åˆ°å¯¼å‡ºæµç¨‹ | app.js exportXXX æ–¹æ³•å†… |

### æ•°æ®æµè®¾è®¡

```javascript
Vue data æ–°å¢:
{
  mp4EditConfig: {
    speedRemap: { ... }  // å˜é€Ÿé…ç½®
  }
}

å¯¼å‡ºæ—¶è¯»å–é…ç½®:
exportToYyevaMp4() {
  let frames = extractFrames(video);
  
  // åº”ç”¨å˜é€Ÿ
  if (mp4EditConfig.speedRemap.enabled) {
    frames = remapFrames(frames, speedRemapConfig);
  }
  
  // ç¼–ç å¯¼å‡º
  encodeToMp4(frames);
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

| åœºæ™¯ | ä¼˜åŒ–æªæ–½ |
|------|----------|
| Kå¸§èŠ‚ç‚¹æ‹–æ‹½ | èŠ‚æµ(throttle 50ms),é¿å…é¢‘ç¹é‡ç»˜ |
| é€Ÿåº¦æ’å€¼è®¡ç®— | ä»…åœ¨èŠ‚ç‚¹é‡Šæ”¾æ—¶è®¡ç®—è¾“å‡ºæ—¶é•¿ |
| å¯¼å‡ºå¤„ç† | ä½¿ç”¨ Web Worker è¿›è¡Œå¸§æå–å’Œæ˜ å°„è®¡ç®— |
| å†…å­˜ç®¡ç† | åŠæ—¶é‡Šæ”¾ä¸´æ—¶ Canvas å’Œ ImageData |
| æ—¶é—´è½´æ¸²æŸ“ | ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–é‡ç»˜ |

### å…¼å®¹æ€§ä¸é™çº§

| åŠŸèƒ½ | æµè§ˆå™¨è¦æ±‚ | é™çº§æ–¹æ¡ˆ |
|------|-----------|----------|
| Canvas æ“ä½œ | ç°ä»£æµè§ˆå™¨ | æ— éœ€é™çº§ |
| æ‹–æ‹½äº¤äº’ | æ”¯æŒé¼ æ ‡äº‹ä»¶ | ç§»åŠ¨ç«¯ä½¿ç”¨è§¦æ‘¸äº‹ä»¶ |
| ffmpeg.wasm | æ”¯æŒ WASM | æç¤ºç”¨æˆ·æ›´æ¢æµè§ˆå™¨ |

---

## å››ã€å¼€å‘ä¼˜å…ˆçº§ä¸å·¥ä½œé‡è¯„ä¼°

### å¼€å‘é¡ºåº

**é˜¶æ®µä¸€:æ—¶é—´è½´é‡æ˜ å°„(å˜é€Ÿ)**(4-5å¤©)
1. Kå¸§æ—¶é—´è½´ç¼–è¾‘å™¨UI(2å¤©)
   - åŸºäºFigmaè®¾è®¡ç¨¿å®ç°400pxÃ—16pxæ—¶é—´è½´
   - Kå¸§èŠ‚ç‚¹æ‹–æ‹½äº¤äº’
   - é€Ÿåº¦è°ƒæ•´å¼¹çª—
2. å…³é”®å¸§æ’å€¼ç®—æ³•(1å¤©)
   - çº¿æ€§æ’å€¼å®ç°
   - é€Ÿåº¦æ›²çº¿è®¡ç®—
3. æ—¶é—´è½´æ˜ å°„è¡¨è®¡ç®—(1å¤©)
   - å¸§æ˜ å°„è¡¨æ„å»º
   - è¾“å‡ºæ—¶é•¿è®¡ç®—
4. å¯¼å‡ºæµç¨‹é›†æˆå˜é€Ÿé€»è¾‘(1å¤©)
   - åº”ç”¨å¸§æ˜ å°„è¡¨åˆ°å¯¼å‡º
   - ä¸‰ç§æ ¼å¼(MP4/SVGA/GIF)æ”¯æŒ

**æ€»å·¥ä½œé‡**:4-5å¤©

### é£é™©è¯„ä¼°

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| Kå¸§æ—¶é—´è½´äº¤äº’å¤æ‚ | å¼€å‘å‘¨æœŸå»¶é•¿ | åŸºäºFigmaè®¾è®¡ç¨¿ç²¾ç¡®å®ç°,é¿å…è¿‡åº¦è®¾è®¡ |
| å˜é€Ÿæ˜ å°„è®¡ç®—æ€§èƒ½ | å¯¼å‡ºé€Ÿåº¦æ…¢ | ä½¿ç”¨ Web Worker åå°è®¡ç®— |
| æ—¶é—´è½´UIç©ºé—´æœ‰é™ | æ“ä½œç²¾åº¦ | ä½¿ç”¨400pxå®½åº¦,ç¡®ä¿å¸§çº§ç²¾åº¦(2.67px/å¸§) |
| å¸§æ˜ å°„ç®—æ³•å‡†ç¡®æ€§ | è¾“å‡ºå¸§é”™è¯¯ | å……åˆ†æµ‹è¯•ä¸åŒé€Ÿåº¦ç»„åˆ,éªŒè¯å¸§ç´¢å¼•æ­£ç¡®æ€§ |

---

## äº”ã€ç”¨æˆ·ä½“éªŒè®¾è®¡

### æ–°æ‰‹å¼•å¯¼

é¦–æ¬¡ä½¿ç”¨æ—¶,åœ¨å˜é€ŸæŒ‰é’®ä¸Šæ˜¾ç¤ºæ°”æ³¡æç¤º:
- "å˜é€Ÿ":é€šè¿‡Kå¸§æ§åˆ¶æ’­æ”¾é€Ÿåº¦,ç²¾ç¡®åˆ°å¸§çº§è°ƒæ•´

### å¿«æ·æ“ä½œ

| åŠŸèƒ½ | æ“ä½œæ–¹å¼ | è¯´æ˜ |
|------|--------|------|
| æ·»åŠ Kå¸§ | ç‚¹å‡»æ—¶é—´è½´ç©ºç™½å¤„ | åœ¨å½“å‰ä½ç½®æ·»åŠ å…³é”®å¸§ |
| è°ƒæ•´Kå¸§é€Ÿåº¦ | ç‚¹å‡»Kå¸§èŠ‚ç‚¹ | å¼¹å‡ºé€Ÿåº¦è°ƒæ•´å¼¹çª— |
| åˆ é™¤Kå¸§ | é€Ÿåº¦å¼¹çª—ä¸­çš„åˆ é™¤æŒ‰é’® | åˆ é™¤å½“å‰å…³é”®å¸§(èµ·ç‚¹/ç»ˆç‚¹ä¸å¯åˆ ) |
| æ‹–æ‹½Kå¸§ | æ‹–æ‹½è“è‰²èŠ‚ç‚¹ | è°ƒæ•´å…³é”®å¸§ä½ç½® |
| ç²¾ç¡®å®šä½ | è¾“å…¥å¸§å· | åœ¨é€Ÿåº¦å¼¹çª—ä¸­æ‰‹åŠ¨è¾“å…¥ |

### é”™è¯¯å¤„ç†

| åœºæ™¯ | æç¤ºå†…å®¹ |
|------|----------|
| å˜é€Ÿå€ç‡è¶…é™ | "é€Ÿåº¦å€ç‡èŒƒå›´:0.5x - 5.0x" |
| Kå¸§ä½ç½®å†²çª | "Kå¸§ä¸èƒ½è¶…è¿‡ç›¸é‚»èŠ‚ç‚¹ä½ç½®" |
| Kå¸§æ•°é‡è¿‡å¤š | "æœ€å¤šæ”¯æŒ10ä¸ªå…³é”®å¸§" |
| å¯¼å‡ºå†…å­˜ä¸è¶³ | "è§†é¢‘è¿‡å¤§æˆ–å˜é€Ÿåå¸§æ•°è¿‡å¤š,å»ºè®®é™ä½è¾“å‡ºè´¨é‡" |

---

## å…­ã€ä¿¡å¿ƒè¯„ä¼°

**ä¿¡å¿ƒç­‰çº§**:é«˜

**ä¿¡å¿ƒåŸºç¡€**:
1. âœ… é¡¹ç›®å·²æœ‰ Canvas æ“ä½œã€å¸§æå–ã€ffmpeg ç¼–ç ç­‰åŸºç¡€èƒ½åŠ›
2. âœ… Kå¸§æ—¶é—´è½´ç¼–è¾‘å™¨æœ‰æ˜ç¡®çš„Figmaè®¾è®¡ç¨¿,UI/äº¤äº’æ¸…æ™°
3. âœ… æ—¶é—´è½´é‡æ˜ å°„ç®—æ³•åŸç†æ¸…æ¥š,å®ç°å¯æ§
4. âœ… ç”¨æˆ·å·²æ˜ç¡®éœ€æ±‚(AIç”ŸæˆçŸ­è§†é¢‘é€Ÿåº¦è°ƒæ•´),æ— éœ€é¢å¤–è°ƒç ”
5. âœ… åŠŸèƒ½èŒƒå›´æåº¦èšç„¦,ä»…ä¿ç•™å˜é€ŸåŠŸèƒ½,å¤æ‚åº¦æœ€ä½
6. âœ… 5ç§’è§†é¢‘150å¸§,å¸§æ˜ å°„è¡¨è®¡ç®—é‡å°,æ€§èƒ½æ— å¿§

**é™ä½é£é™©æªæ–½**:
- Kå¸§ç¼–è¾‘å™¨ä¸¥æ ¼æŒ‰ç…§Figmaè®¾è®¡ç¨¿å®ç°(400pxÃ—16px)
- å……åˆ†å¤ç”¨ç°æœ‰ä»£ç ,å‡å°‘æ–°å¢æ¨¡å—
- å˜é€Ÿç®—æ³•å…ˆä½¿ç”¨çº¿æ€§æ’å€¼,åç»­å¯è¿­ä»£å¹³æ»‘æ’å€¼
- åƒç´ -å¸§å·æ˜ å°„ç²¾åº¦éªŒè¯(2.67px/å¸§)
- ä½¿ç”¨ Web Worker å¤„ç†å¸§æ˜ å°„è®¡ç®—,é¿å…é˜»å¡UI
