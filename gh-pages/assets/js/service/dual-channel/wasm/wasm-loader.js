!function(e){"use strict";window.MeeWoo=window.MeeWoo||{},window.MeeWoo.Services=window.MeeWoo.Services||{};class s{constructor(){this.module=null,this.instance=null,this.memory=null,this.imports={env:{memoryBase:0,tableBase:0,memory:new WebAssembly.Memory({initial:256,maximum:1024,shared:!1}),table:new WebAssembly.Table({initial:0,maximum:0,element:"anyfunc"}),abort:function(e,s,t,o){console.error("WebAssembly abort:",e,s,t,o)},malloc:function(e){return 0},free:function(e){}}},this.isLoaded=!1,this.isSupported=this._checkWasmSupport(),this.stats={loadTime:0,initTime:0,calls:0,errors:0}}_checkWasmSupport(){return"undefined"!=typeof WebAssembly}async load(e){if(!this.isSupported)throw new Error("WebAssembly is not supported in this browser");if(this.isLoaded)return this.instance;try{const s=performance.now(),t=await fetch(e),o=await t.arrayBuffer();if(this.module=await WebAssembly.compile(o),this.instance=await WebAssembly.instantiate(this.module,this.imports),this.memory=this.imports.env.memory,this.instance.exports.init){const e=performance.now();this.instance.exports.init(),this.stats.initTime=performance.now()-e}return this.stats.loadTime=performance.now()-s,this.isLoaded=!0,console.log("WebAssembly模块加载成功，加载时间:",this.stats.loadTime.toFixed(2),"ms"),console.log("WebAssembly初始化时间:",this.stats.initTime.toFixed(2),"ms"),this.instance}catch(e){throw console.error("WebAssembly模块加载失败:",e),this.stats.errors++,new Error("Failed to load WebAssembly module: "+e.message)}}processSinglePixel(e,s,t,o,i,r,n,l){if(!this.isLoaded||!this.instance.exports.processSinglePixel)throw new Error("WebAssembly module not loaded or function not exported");try{this.stats.calls++,this.instance.exports.processSinglePixel(e,s,t.buffer,o,i,r.buffer,n.buffer,l?1:0)}catch(e){throw console.error("WebAssembly processSinglePixel error:",e),this.stats.errors++,e}}processBlock(e,s,t,o,i,r,n,l,a,m){if(!this.isLoaded||!this.instance.exports.processBlock)throw new Error("WebAssembly module not loaded or function not exported");try{this.stats.calls++,this.instance.exports.processBlock(e,s,t,o,i.buffer,r,n,l.buffer,a.buffer,m?1:0)}catch(e){throw console.error("WebAssembly processBlock error:",e),this.stats.errors++,e}}getMemoryView(e,s){if(!this.memory)throw new Error("WebAssembly memory not initialized");return new Uint8Array(this.memory.buffer,e,s)}growMemory(e){if(this.memory){const s=this.memory.grow(e);-1===s?console.error("Failed to grow WebAssembly memory"):console.log("WebAssembly memory grown to",64*(s+e),"KB")}}dispose(){this.module=null,this.instance=null,this.memory=null,this.isLoaded=!1,console.log("WebAssembly resources disposed")}getStats(){return{...this.stats}}resetStats(){this.stats={loadTime:this.stats.loadTime,initTime:this.stats.initTime,calls:0,errors:0}}getIsLoaded(){return this.isLoaded}getIsSupported(){return this.isSupported}}const t=new s;window.MeeWoo.Services.WasmLoader=t,"undefined"!=typeof module&&module.exports?module.exports=s:e.WasmLoader=s}("undefined"!=typeof window?window:this);