!function(e){"use strict";window.MeeWoo=window.MeeWoo||{},window.MeeWoo.Services=window.MeeWoo.Services||{};const t=new class{constructor(){this.pools=new Map,this.stats={allocated:0,reused:0,peak:0,active:0},this.maxPoolSize=100,this.minBufferSize=1024,this.maxBufferSize=104857600}getBuffer(e,t){if(t<=0||t>this.maxBufferSize)return this._createBuffer(e,t);const s=this._roundUpToPowerOfTwo(t),r=`${e}_${s}`;if(this.pools.has(r)&&this.pools.get(r).length>0){const e=this.pools.get(r).pop();return this.stats.reused++,this.stats.active++,e}return this._createBuffer(e,s)}recycleBuffer(e){if(!e||!e.buffer)return;const t=e.constructor.name,s=e.length;if(s<=0||s>this.maxBufferSize)return void this._updateStats(!1,s);const r=`${t}_${this._roundUpToPowerOfTwo(s)}`;this.pools.has(r)||this.pools.set(r,[]);const o=this.pools.get(r);o.length<this.maxPoolSize?(this._resetBuffer(e),o.push(e),this.stats.active--):this._updateStats(!1,s)}getBuffers(e){return e.map(e=>this.getBuffer(e.type,e.size))}recycleBuffers(e){e.forEach(e=>this.recycleBuffer(e))}clear(){this.pools.forEach((e,t)=>{e.forEach(e=>{this._updateStats(!1,e.length)}),e.length=0}),this.pools.clear(),this.stats.active=0}getStats(){return{...this.stats}}resetStats(){this.stats={allocated:0,reused:0,peak:0,active:0}}_createBuffer(e,t){let s;try{switch(e){case"Uint8ClampedArray":s=new Uint8ClampedArray(t);break;case"Uint8Array":s=new Uint8Array(t);break;default:throw new Error(`Unsupported buffer type: ${e}`)}this._updateStats(!0,t),this.stats.active++}catch(e){throw console.error("Buffer creation failed:",e),e}return s}_resetBuffer(e){try{if(e.fill)e.fill(0);else for(let t=0;t<e.length;t++)e[t]=0}catch(e){console.error("Buffer reset failed:",e)}}_updateStats(e,t){e&&(this.stats.allocated+=t,this.stats.peak=Math.max(this.stats.peak,this.stats.active*t))}_roundUpToPowerOfTwo(e){return e<=this.minBufferSize?this.minBufferSize:(e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e)}};window.MeeWoo.Services.MemoryPool=t,"undefined"!=typeof module&&module.exports?module.exports=t:e.MemoryPool=t}("undefined"!=typeof window?window:this);