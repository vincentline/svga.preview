!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};const o={version:"1.0.0",features:{advertisement:{enabled:!1,position:"right-float"}}};e.MeeWoo.Core.SiteConfig=new class{constructor(){this.config=null,this.loaded=!1,this.callbacks=[]}async load(t="https://blog-1258489735.cos.ap-chengdu.myqcloud.com/other/svga_set/site-config.json"){if(this.loaded&&this.config)return this.config;if(["localhost","127.0.0.1","0.0.0.0",""].includes(e.location.hostname))try{console.log("[SiteConfig] 本地环境，尝试加载本地配置");const e="/site-config.json",o=await fetch(e);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();if(this.validateConfig(t))return this.config=t,this.loaded=!0,console.log("[SiteConfig] 本地配置加载成功:",t),t;throw new Error("Invalid local config format")}catch(e){return console.warn("[SiteConfig] 本地配置加载失败，使用默认配置:",e.message),this.config=o,this.loaded=!0,o}try{const e=this.buildCacheBustingUrl(t),o=new AbortController,i=setTimeout(()=>o.abort(),3e3),n=await fetch(e,{method:"GET",signal:o.signal,headers:{Accept:"application/json"}});if(clearTimeout(i),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(!this.validateConfig(s))throw new Error("Invalid config format");return this.config=s,this.loaded=!0,console.log("[SiteConfig] 配置加载成功:",s),s}catch(e){return console.warn("[SiteConfig] 配置加载失败，使用默认配置:",e.message),this.config=o,this.loaded=!0,o}}buildCacheBustingUrl(e){const o=Date.now(),t=e.includes("?")?"&":"?";return`${e}${t}t=${o}`}validateConfig(e){return!(!e||"object"!=typeof e)&&!(!e.version||!e.features)}getFeature(e){return this.config&&this.config.features&&this.config.features[e]||null}isFeatureEnabled(e){const o=this.getFeature(e);return o&&!0===o.enabled}getUserLevelsConfig(){return this.getFeature("userLevels")||{}}ready(){return this.loaded?Promise.resolve(this.config):new Promise(e=>{this.callbacks.push(e)})}notifyCallbacks(){this.callbacks.forEach(e=>e(this.config)),this.callbacks=[]}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.MeeWoo.Core.SiteConfig.load().then(()=>{e.MeeWoo.Core.SiteConfig.notifyCallbacks()})}):e.MeeWoo.Core.SiteConfig.load().then(()=>{e.MeeWoo.Core.SiteConfig.notifyCallbacks()})}(window);