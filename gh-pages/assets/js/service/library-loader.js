!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};var n={vue:{name:"Vue.js",url:"assets/js/lib/vue.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.min.js","https://unpkg.com/vue@2.7.14/dist/vue.min.js","https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.14/vue.min.js"],checkFn:function(){return"undefined"!=typeof Vue},priority:0},oxipng:{name:"oxipng",url:"assets/js/service/oxipng/codec/pkg/squoosh_oxipng_bg.wasm",checkFn:function(){return void 0!==e.MeeWoo&&void 0!==e.MeeWoo.Services&&void 0!==e.MeeWoo.Services.ImageCompressionService&&e.MeeWoo.Services.ImageCompressionService.isOxipngReady()},priority:25,disabled:!0},svgaplayer:{name:"SVGA Player",url:"assets/js/lib/svga.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/svgaplayerweb@2.3.1/build/svga.min.js","https://unpkg.com/svgaplayerweb@2.3.1/build/svga.min.js"],checkFn:function(){return"undefined"!=typeof SVGA&&SVGA.Player},priority:1},lottie:{name:"Lottie",url:"assets/js/lib/lottie.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/lottie-web@5.12.2/build/player/lottie.min.js","https://unpkg.com/lottie-web@5.12.2/build/player/lottie.min.js","https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"],checkFn:function(){return"undefined"!=typeof lottie},priority:5},howler:{name:"Howler.js",url:"assets/js/lib/howler.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"],checkFn:function(){return"undefined"!=typeof Howl},priority:6},marked:{name:"Marked",url:"assets/js/lib/marked.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"],checkFn:function(){return"undefined"!=typeof marked},priority:20},gif:{name:"GIF.js",url:"assets/js/lib/gif.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"],checkFn:function(){return"undefined"!=typeof GIF},priority:15},protobuf:{name:"Protobuf.js",url:"assets/js/lib/protobuf.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/protobufjs@7.2.5/dist/protobuf.min.js"],checkFn:function(){return"undefined"!=typeof protobuf},priority:25},pako:{name:"Pako",url:"assets/js/lib/pako.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"],checkFn:function(){return"undefined"!=typeof pako},priority:25},jszip:{name:"JSZip",url:"assets/js/lib/jszip.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"],checkFn:function(){return"undefined"!=typeof JSZip},priority:25},pngquant:{name:"PNG Compressor (Pako)",url:"assets/js/lib/pako.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js","https://unpkg.com/pako@2.1.0/dist/pako.min.js","https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako.min.js","https://unpkg.com/pako@2.0.4/dist/pako.min.js"],checkFn:function(){return"undefined"!=typeof pako},priority:26,disabled:!0},svgaweb:{name:"SVGA-Web",url:"https://cdn.jsdelivr.net/npm/svga-web@2.4.2/svga-web.min.js",checkFn:function(){return"undefined"!=typeof SVGA&&SVGA.Downloader},priority:25,disabled:!0},ffmpeg:{name:"FFmpeg",url:"https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js",checkFn:function(){return"undefined"!=typeof FFmpeg},priority:30},html2canvas:{name:"html2canvas",url:"assets/js/lib/html2canvas.min.js",fallbackUrls:["https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"],checkFn:function(){return"undefined"!=typeof html2canvas},priority:25},konva:{name:"Konva",url:"assets/js/lib/konva.min.js",fallbackUrls:["https://cdn.jsdelivr.net/npm/konva@9.3.6/konva.min.js","https://unpkg.com/konva@9.3.6/konva.min.js","https://cdnjs.cloudflare.com/ajax/libs/konva/9.3.6/konva.min.js"],checkFn:function(){return"undefined"!=typeof Konva},priority:10}};function r(){this.queue=[],this.loading=!1,this.currentLib=null,this.loadedLibs={},this.listeners=[]}r.prototype.onProgress=function(e){"function"==typeof e&&this.listeners.push(e)},r.prototype.notifyProgress=function(){var e=this.currentLib;this.listeners.forEach(function(n){try{n(e)}catch(e){}})},r.prototype.loadSingleLibrary=function(e,r){var t=this,i=n[e];if(!i)return Promise.reject(new Error("未知的库: "+e));if(this.loadedLibs[e]||i.checkFn&&i.checkFn())return this.loadedLibs[e]=!0,Promise.resolve();var o=[i.url];i.fallbackUrls&&i.fallbackUrls.length>0&&(o=o.concat(i.fallbackUrls));var s=function(n){if(n>=o.length)return Promise.reject(new Error("所有CDN都加载失败: "+e));var r=o[n];return"import"===i.loadMethod?new Promise(function(n,o){t.currentLib={name:i.name,url:r,progress:0},t.notifyProgress();var s=document.createElement("script");s.type="module",s.src=r,s.onload=function(){t.currentLib.progress=50,t.notifyProgress();var r=30,s=function(){if(!i.checkFn||i.checkFn())t.currentLib.progress=100,t.notifyProgress(),setTimeout(function(){t.currentLib=null,t.loadedLibs[e]=!0,t.notifyProgress(),n()},300);else if(r-- >0){var a=50+1.5*(30-r);t.currentLib.progress=Math.min(99,Math.round(a)),t.notifyProgress(),setTimeout(s,100)}else t.currentLib=null,t.notifyProgress(),o(new Error("库加载超时: "+e))};s()},s.onerror=function(){t.currentLib=null,t.notifyProgress(),o(new Error("加载失败: "+r))},document.head.appendChild(s)}).catch(function(e){return i.fallbackUrls&&i.fallbackUrls.length>0&&n<o.length-1?s(n+1):Promise.reject(e)}):new Promise(function(n,o){t.currentLib={name:i.name,url:r,progress:0},t.notifyProgress();var s=document.createElement("script");s.src=r,s.onload=function(){t.currentLib.progress=50,t.notifyProgress();var r=30,s=function(){if(!i.checkFn||i.checkFn())t.currentLib.progress=100,t.notifyProgress(),setTimeout(function(){t.currentLib=null,t.loadedLibs[e]=!0,t.notifyProgress(),n()},300);else if(r-- >0){var a=50+1.5*(30-r);t.currentLib.progress=Math.min(99,Math.round(a)),t.notifyProgress(),setTimeout(s,100)}else t.currentLib=null,t.notifyProgress(),o(new Error("库加载超时: "+e))};s()},s.onerror=function(){t.currentLib=null,t.notifyProgress(),o(new Error("加载失败: "+r))},document.head.appendChild(s)}).catch(function(e){return i.fallbackUrls&&i.fallbackUrls.length>0&&n<o.length-1?s(n+1):Promise.reject(e)})};return s(0)},r.prototype.load=function(e,n){var r=this;return"string"==typeof e&&(e=[e]),new Promise(function(t,i){var o={libs:e,priority:n?0:10,resolve:t,reject:i};n?r.queue.unshift(o):r.queue.push(o),r.processQueue()})},r.prototype.processQueue=function(){var e=this;if(!this.loading&&0!==this.queue.length){this.loading=!0,this.queue.sort(function(e,n){return e.priority-n.priority});var n=this.queue.shift();if(0===n.priority){for(var r=[],t=0;t<n.libs.length;t+=5)r.push(n.libs.slice(t,t+5));var i=Promise.resolve();r.forEach(function(n){i=i.then(function(){var r=n.map(function(n){return e.loadSingleLibrary(n,!0)});return Promise.all(r)})}),i.then(function(){n.resolve(),e.loading=!1,e.processQueue()}).catch(function(r){n.reject(r),e.loading=!1,e.processQueue()})}else{var o=Promise.resolve();n.libs.forEach(function(r){o=o.then(function(){return e.loadSingleLibrary(r,0===n.priority)})}),o.then(function(){n.resolve(),e.loading=!1,e.processQueue()}).catch(function(r){n.reject(r),e.loading=!1,e.processQueue()})}}},r.prototype.preload=function(){var e=this,r=Object.keys(n).map(function(e){return{key:e,priority:n[e].priority}}).sort(function(e,n){return e.priority-n.priority}).filter(function(r){var t=n[r.key];return!e.isLoaded(r.key)&&!t.disabled}).map(function(e){return e.key});0!==r.length&&setTimeout(function(){r.forEach(function(n){e.load(n,!1).catch(function(e){})})},1e3)},r.prototype.isLoaded=function(e){var r=n[e];return!!r&&(this.loadedLibs[e]||r.checkFn&&r.checkFn())},r.prototype.getConfig=function(e){return e?n[e]:n},e.MeeWoo.Core.LibraryLoader=r,e.MeeWoo.Core.libraryLoader=new r}(window);