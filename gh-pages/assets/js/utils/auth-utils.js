class AuthUtils{constructor(){this.tokenKey="imghelptoken",this.userKey="imghelpuser",this.loginUrl="https://www.imghlp.com/auth/login.html"}isLoggedIn(){try{return!!localStorage.getItem(this.tokenKey)}catch(e){return console.error("检查登录状态失败:",e),!1}}getToken(){try{return localStorage.getItem(this.tokenKey)}catch(e){return console.error("获取Token失败:",e),null}}getUserInfo(){try{const e=localStorage.getItem(this.userKey);return e?JSON.parse(e):null}catch(e){return console.error("获取用户信息失败:",e),null}}saveToken(e){try{return localStorage.setItem(this.tokenKey,e),!0}catch(e){return console.error("存储Token失败:",e),!1}}saveUserInfo(e){try{const t={username:e.username||"",id:e.id||""};return localStorage.setItem(this.userKey,JSON.stringify(t)),!0}catch(e){return console.error("存储用户信息失败:",e),!1}}clearAuth(){try{return localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.userKey),!0}catch(e){return console.error("清除登录信息失败:",e),!1}}redirectToLogin(e){const t=encodeURIComponent(e||window.location.href);window.location.href=`${this.loginUrl}?returnUrl=${t}`}handleLoginCallback(){const e=new URLSearchParams(window.location.search),t=e.get("authToken")||e.get("token"),r=e.get("userInfo")||e.get("user");if(t&&r)try{this.saveToken(t),this.saveUserInfo(JSON.parse(r));const e=new URL(window.location.href);return e.searchParams.delete("authToken"),e.searchParams.delete("token"),e.searchParams.delete("userInfo"),e.searchParams.delete("user"),window.history.replaceState({},"",e.toString()),!0}catch(e){return console.error("处理登录回调失败:",e),!1}return!1}}const authUtils=new AuthUtils;window.authUtils=authUtils;