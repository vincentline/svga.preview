!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Controllers=e.MeeWoo.Controllers||{};e.MeeWoo.Controllers.AdController=new class{constructor(){this.initialized=!1,this.containers=new Map}async init(){if(this.initialized)return;e.MeeWoo&&e.MeeWoo.Core&&e.MeeWoo.Core.SiteConfig&&await e.MeeWoo.Core.SiteConfig.ready(),this.findAdContainers();["localhost","127.0.0.1"].includes(e.location.hostname)?console.log("[AdController] 本地环境，跳过广告加载"):(this.applyConfig(),this.initialized=!0)}findAdContainers(){document.querySelectorAll("[data-ad-position]").forEach(e=>{const o=e.getAttribute("data-ad-position");this.containers.set(o,e)})}applyConfig(){let o=null,t={};if(e.MeeWoo&&e.MeeWoo.Core&&e.MeeWoo.Core.SiteConfig){o=e.MeeWoo.Core.SiteConfig.getFeature("advertisement");let n="anonymous";e.authUtils&&e.authUtils.isLoggedIn()&&(n="loggedIn");const i=e.MeeWoo.Core.SiteConfig.getFeature("userLevels")||{};let s={...i.anonymous||{}};if("loggedIn"===n||"admin"===n){const e=i.loggedIn||{};s={...s,...e}}if("admin"===n){const e=i.admin||{};s={...s,...e}}t=s}if(!o)return void this.hideAllAds();const{enabled:n,position:i}=o,{showAdvertisement:s=!0}=t;n&&i&&s?this.showAd(i):this.hideAllAds()}showAd(e){const o=this.containers.get(e);o?(o.style.display="block",o.setAttribute("data-ad-visible","true"),this.initAdSense(o)):console.warn(`[AdController] 未找到广告位容器: ${e}`)}initAdSense(o){this.loadAdSenseScript();const t=o.querySelectorAll(".adsbygoogle");if(t.length>0&&e.adsbygoogle)try{t.forEach(o=>{o.getAttribute("data-adsbygoogle-status")||(e.adsbygoogle=e.adsbygoogle||[]).push({})})}catch(e){console.error("[AdController] AdSense 初始化失败:",e)}}loadAdSenseScript(){if(document.getElementById("adsense-script"))return;const e=document.createElement("script");e.id="adsense-script",e.async=!0,e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9291089781078791",e.crossOrigin="anonymous",e.onerror=e=>{console.warn("[AdController] AdSense 脚本加载失败或被拦截 (正常现象):",e)},document.head.appendChild(e)}hideAd(e){const o=this.containers.get(e);o&&(o.style.display="none",o.setAttribute("data-ad-visible","false"))}hideAllAds(){this.containers.forEach((e,o)=>{this.hideAd(o)})}isAdVisible(e){const o=this.containers.get(e);return!!o&&"true"===o.getAttribute("data-ad-visible")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.MeeWoo.Controllers.AdController.init()}):e.MeeWoo.Controllers.AdController.init()}(window);