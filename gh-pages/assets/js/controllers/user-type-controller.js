!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Controllers=e.MeeWoo.Controllers||{};if(e.MeeWoo.Controllers.UserTypeController=new class{constructor(){this.initialized=!1,this.elements=new Map,this.observers=[],this.lastLoginStatus=null,this.pollingInterval=null,this.customRules=new Map}async init(){this.initialized||(e.MeeWoo&&e.MeeWoo.Core&&e.MeeWoo.Core.SiteConfig&&await e.MeeWoo.Core.SiteConfig.ready(),this.findControlledElements(),this.applyUserTypeConfig(),this.initialized=!0)}findControlledElements(){document.querySelectorAll("[data-user-type]").forEach(e=>{const t=e.getAttribute("data-user-type");this.elements.has(t)||this.elements.set(t,[]),this.elements.get(t).push(e)})}getUserType(){return e.authUtils&&e.authUtils.isLoggedIn()?"loggedIn":"anonymous"}applyUserTypeConfig(){const t=this.getUserType();let s={};if(e.MeeWoo&&e.MeeWoo.Core&&e.MeeWoo.Core.SiteConfig){s=e.MeeWoo.Core.SiteConfig.getFeature("userLevels")||{}}const o=this.mergeUserLevelConfigs(t,s);if(o.showAllButtons)return void this.elements.forEach((e,t)=>{e.forEach(e=>{this.showElement(e)})});const i=o.hideButtons||[],n=o.showButtons||[];i.forEach(e=>{const t=this.elements.get(e);t&&t.forEach(e=>{this.hideElement(e)})}),n.forEach(e=>{const t=this.elements.get(e);t&&t.forEach(e=>{this.showElement(e)})}),this.elements.forEach((e,t)=>{i.includes(t)||n.includes(t)||e.forEach(e=>{this.showElement(e)})})}mergeUserLevelConfigs(e,t){let s={...t.anonymous||{}};if("loggedIn"===e||"admin"===e){const e=t.loggedIn||{};s={...s,...e}}if("admin"===e){const e=t.admin||{};s={...s,...e}}return s}showElement(e){e&&(e.style.display="",e.style.visibility="visible",e.setAttribute("data-user-visible","true"))}hideElement(e){e&&(e.style.display="none",e.style.visibility="hidden",e.setAttribute("data-user-visible","false"))}isElementVisible(e){const t=this.elements.get(e);if(!t||0===t.length)return!1;const s=t[0];return s&&"true"===s.getAttribute("data-user-visible")}refresh(){this.findControlledElements(),this.applyUserTypeConfig()}startLoginStatusPolling(){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=setInterval(()=>{const t=e.authUtils&&e.authUtils.isLoggedIn();t!==this.lastLoginStatus&&(this.lastLoginStatus=t,this.refresh(),this.notifyObservers())},500)}stopLoginStatusPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}addObserver(e){"function"!=typeof e||this.observers.includes(e)||this.observers.push(e)}removeObserver(e){const t=this.observers.indexOf(e);t>-1&&this.observers.splice(t,1)}notifyObservers(){const t=e.authUtils&&e.authUtils.isLoggedIn(),s=this.getUserType();this.observers.forEach(e=>{try{e(t,s)}catch(e){console.error("Observer callback error:",e)}})}registerElement(e,t){"string"==typeof e&&(e=document.querySelector(e)),e&&t&&(e.setAttribute("data-user-type",t),this.refresh())}registerElements(e){e.forEach(e=>{this.registerElement(e.element,e.type)})}shouldShowElement(t){if(this.customRules&&this.customRules.has(t)){const e=this.customRules.get(t);try{return e()}catch(e){console.error("Custom rule error:",e)}}const s=this.getUserType();let o={};if(e.MeeWoo&&e.MeeWoo.Core&&e.MeeWoo.Core.SiteConfig){o=e.MeeWoo.Core.SiteConfig.getFeature("userLevels")||{}}const i=this.mergeUserLevelConfigs(s,o);if(i.showAllButtons)return!0;const n=i.hideButtons||[];return!!(i.showButtons||[]).includes(t)||!n.includes(t)}isLoggedIn(){return e.authUtils&&e.authUtils.isLoggedIn()}getCurrentUserType(){return this.getUserType()}addCustomRule(e,t){this.customRules||(this.customRules=new Map),this.customRules.set(e,t)}removeCustomRule(e){this.customRules&&this.customRules.delete(e)}},"loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{const t=e.MeeWoo.Controllers.UserTypeController;t.init().then(()=>{t.startLoginStatusPolling()})});else{const t=e.MeeWoo.Controllers.UserTypeController;t.init().then(()=>{t.startLoginStatusPolling()})}}(window);