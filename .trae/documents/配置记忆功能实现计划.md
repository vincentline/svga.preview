# 配置记忆功能实现计划 (独立模块版)

## 目标

实现用户偏好设置的持久化存储，逻辑独立于 `app.js`，以保持代码整洁。

## 技术方案

1. **新建模块**: 创建 `docs/assets/js/config-manager.js`，封装配置管理逻辑。
2. **存储策略**: 使用 `localStorage` 存储 JSON 对象，Key 为 `svga_preview_user_config`。
3. **集成方式**: 在 `index.html` 引入新脚本，在 `app.js` 中调用其实例。

## 详细步骤

### 1. 创建 `ConfigManager` (`docs/assets/js/config-manager.js`)

实现一个全局类 `ConfigManager`，提供以下 API：

* `get(key, defaultValue)`: 获取配置项。

* `set(key, value)`: 设置并自动持久化配置项。

* `getAll()`: 获取所有配置（用于初始化）。

### 2. 引入脚本 (`docs/index.html`)

在 `app.js` 之前引入 `config-manager.js`。

### 3. 集成到主应用 (`docs/assets/js/app.js`)

* **初始化**: 在 `created` 生命周期中实例化 `this.configManager`。

* **状态恢复**:

  * `bgColorKey`: `this.configManager.get('bgColorKey', 'pattern')`

  * `currentModule`: `this.configManager.get('lastMode', 'svga')`

  * `gifConfig`: 从 `this.configManager.get('gifConfig', {})` 合并默认值。

* **状态监听 (Watchers)**:

  * 监听 `bgColorKey` -> `this.configManager.set('bgColorKey', val)`

  * 监听 `currentModule` -> `this.configManager.set('lastMode', val)`

  * 监听 `gifConfig` (deep) -> `this.configManager.set('gifConfig', val)` (配合防抖)

* **智能尺寸逻辑**:

  * 在 `openGifPanel` 中，检查 `configManager.get('gifConfig').width`。

  * 如果存在，将其设为宽度，并按当前素材比例自动计算高度，实现“记忆默认尺寸”且防止变形。

## 文件变更列表

1. `+ docs/assets/js/config-manager.js`
2. `M docs/index.html`
3. `M docs/assets/js/app.js`
