# 优化暗黑模式适配方案

## 问题分析
当前手机浏览器的暗黑模式会强制覆盖页面颜色，导致即使在普通模式下也显示黑色背景。这是因为浏览器的自动暗黑模式会修改页面的默认颜色值。

## 解决方案
1. **拒绝浏览器自动控制颜色**：通过 `color-scheme` 元标签明确告诉浏览器我们自己控制颜色
2. **智能检测浏览器主题**：在初始化时检测浏览器的主题偏好
3. **临时存储用户选择**：使用 `sessionStorage` 存储用户的主题选择，仅在当前会话有效
4. **支持手动切换**：保持现有的主题切换功能
5. **响应系统变化**：仅在用户未手动设置时响应系统主题变化

## 实现步骤

### 1. 修改 HTML 头部
在 `<head>` 中添加 `color-scheme` 元标签，拒绝浏览器自动控制颜色：
```html
<meta name="color-scheme" content="light dark" />
<style>
  :root {
    color-scheme: light dark;
  }
  /* 确保背景色不受浏览器影响 */
  html {
    background-color: #fcfcfc;
  }
  body.dark-mode html {
    background-color: #1a1a1a;
  }
</style>
```

### 2. 修改主题初始化逻辑
在 `created` 钩子中添加主题初始化逻辑：
- 优先检查 `sessionStorage` 中的用户选择
- 其次检测浏览器主题偏好
- 最后默认使用亮色模式

### 3. 修改 toggleTheme 方法
- 在切换主题时更新 `sessionStorage`
- 保持现有的 `isThemeManuallySet` 标记

### 4. 添加系统主题变化监听
- 使用 `window.matchMedia('(prefers-color-scheme: dark)')` 监听系统主题变化
- 仅在用户未手动设置时响应变化

### 5. 测试验证
- 测试在手机浏览器暗黑模式下的表现
- 测试主题切换功能
- 测试页面刷新后主题是否保持
- 测试不同设备和浏览器的兼容性

## 技术要点
- 使用 `sessionStorage` 存储临时偏好，避免持久化影响
- 使用 `matchMedia` API 检测和监听系统主题
- 通过 CSS 变量和类名实现主题切换
- 确保所有颜色都通过 CSS 类控制，不依赖浏览器默认值

## 预期效果
- 手机浏览器无论是否开启暗黑模式，都能正确显示我们的主题
- 用户可以手动切换主题，选择会在当前会话中保持
- 首次访问时会自动匹配浏览器的主题偏好
- 系统主题变化时，仅在用户未手动设置时才响应