# 项目功能迭代与架构升级计划文档

基于对现有代码库的深度分析及用户需求的梳理，本项目（SVGA/Lottie/MP4 预览与转换工具）的后续开发计划如下。

## 📅 阶段规划概览

### 第一阶段：体验升级与基础建设 (P0 - High Priority)

**目标**：提升工具的易用性与品牌感，清理残留代码，夯实地基。

1. **播放控制增强 (需求 1)已完成**

   * **功能**：增加键盘左右键快进/快退功能。

   * **逻辑**：

     * 视频时长 < 2s:不响应

     * 视频时长 < 10s: ±1s

     * 视频时长 11-60s: ±2s

     * 视频时长 > 60s: ±10s

   * **技术实现**：在 `app.js` 挂载全局键盘监听，调用 `PlayerController` 接口。
2. **品牌化建设 (需求 10)已完成**

   * **功能**：设计并添加项目图标 (Favicon)、Logo 及确定项目名称。

   * **技术实现**：更新 `index.html` 的 `<title>` 和 `<link rel="icon">`，设计 UI 头部展示。
3. **配置记忆功能 (新建议)已完成**

   * **功能**：记住用户的偏好设置（如背景色、默认输出尺寸、上次使用的模式）。

   * **技术实现**：使用 `localStorage` 存储和读取配置。
4. **技术债务终结 (需求 14)已完成**

   * **功能**：彻底删除 `app.js` 中已注释的废弃代码（如旧版 `encodeToMP4`），缩减文件体积。

   * **技术实现**：代码清理。

### 第二阶段：核心编辑能力强化 (P1 - Core Features)

**目标**：完善 SVGA 和视频的基础编辑能力，从“预览”向“编辑”转型。

1. **SVGA 素材编辑增强 (需求 7 & 8)**

   * **功能**：

     * 文案对齐方式（左/中/右）。

     * 素材（底图/文案）旋转支持。

   * **技术实现**：修改 `MaterialEditor` 组件，在 Canvas 绘制逻辑中引入 `ctx.rotate()` 和对齐计算。
2. **视频尺寸裁切 (需求 3)**

   * **功能**：允许用户自定义输出视频的宽高，支持居中裁切。

   * **技术实现**：在 `ffmpeg-service.js` 的转码滤镜中添加 `crop` 参数，前端增加裁切交互 UI。
3. **移动端兼容 (需求 12)**

   * **功能**：确保在手机浏览器上能正常播放和进行基础转换。

   * **技术实现**：优化 Viewport 设置，调整移动端下的按钮尺寸和布局，禁用不兼容的高级交互。

### 第三阶段：高级多媒体处理 (P2 - Advanced)

**目标**：利用 Web 技术实现桌面级的媒体处理能力。

1. **WebP 全面支持 (需求 13)**

   * **功能**：支持 WebP 格式的导入预览及导出。

   * **技术实现**：利用 FFmpeg 的 `libwebp` 编码器，扩展 `ffmpeg-service.js` 的格式支持。
2. **智能变速 (需求 6)**

   * **功能**：支持视频时长延长（补帧/慢放），最大增加原始时长的 20%。

   * **技术实现**：修改 `ffmpeg-service.js` 中的 `setpts` 滤镜逻辑，计算精确的时间戳映射。
3. **双通道多段变速 (需求 5)**

   * **功能**：在双通道模式下支持分段变速。

   * **技术实现**：复用上述变速逻辑，应用于 Alpha 和 RGB 两个通道。

### 第四阶段：架构优化与性能攻坚 (P3 - Optimization)

**目标**：引入前沿 Web 技术，突破浏览器性能瓶颈。

1. **ES Modules 模块化改造 (技术建议)**

   * **目标**：废除全局变量依赖，使用 `<script type="module">` 和 `import/export`。

   * **价值**：解决依赖混乱问题，为未来拆分 `app.js` 铺路。
2. **WASM 图片压缩 (需求 15 替代方案)**

   * **目标**：引入 `libimagequant` (pngquant) 的 WASM 版本。

   * **价值**：在本地实现服务器级的 PNG 压缩率，无需依赖后端。

## ⚠️ 暂缓/不建议的功能 (Won't Do)

1. **后端服务 (原需求 15)**：保持纯静态架构，避免引入运维成本。
2. **AI 抠图 (原需求 4)**：浏览器端性能开销过大，暂不引入。
3. **复杂音频波形编辑 (原需求 11)**：投入产出比低，优先做简单的音频替换/静音。
4. **MP4 拼接 (原需求 2)**：交互过于复杂，待有明确 UI 方案后再议。
5. **首页掷骰子 (原需求 9)**：低优先级彩蛋，待核心功能完成后再做。

***

**当前建议行动**：确认此计划后，我们将立即开始 **第一阶段：体验升级**，首个任务是 **实现键盘播放控制**。
