# 实现用户类型控制功能

## 需求分析

* **面向大众**：隐藏左侧边栏的素材自助、名人礼物视频版、Avatar小图标生成按钮；显示右侧浮层广告

* **面向内部**：显示所有内容；隐藏右侧浮层广告

* **实现方式**：通过URL参数区分用户类型，配置文件控制显示逻辑

## 技术方案

### 1. 扩展配置文件

* 在 `site-config.json` 中添加用户类型相关配置

* 保持现有广告位配置结构不变

* 新增用户类型控制配置项

### 2. 修改配置加载器

* 在 `site-config-loader.js` 中添加URL参数解析功能

* 根据URL参数（如 `?type=internal`）确定用户类型

* 提供用户类型相关的获取方法

### 3. 创建用户类型控制器

* 新增 `user-type-controller.js` 文件

* 负责根据用户类型控制左侧边栏按钮的显示/隐藏

* 为需要控制的按钮添加 `data-user-type` 属性

### 4. 修改广告控制器

* 在 `ad-controller.js` 中添加用户类型判断逻辑

* 面向内部用户时隐藏广告位

### 5. 更新HTML结构

* 在 `index.html` 中为左侧边栏按钮添加 `data-user-type` 属性

* 确保按钮能够被控制器正确识别和控制

## 实现步骤

1. **更新配置文件** `site-config.json`：

   * 添加用户类型控制配置

   * 版本号递增

2. **修改配置加载器** `site-config-loader.js`：

   * 添加URL参数解析方法

   * 扩展配置加载逻辑

   * 新增用户类型相关方法

3. **创建用户类型控制器** `user-type-controller.js`：

   * 实现按钮显示/隐藏逻辑

   * 与配置加载器集成

4. **修改广告控制器** `ad-controller.js`：

   * 添加用户类型判断

   * 根据用户类型控制广告显示

5. **更新HTML结构** `index.html`：

   * 为目标按钮添加 `data-user-type` 属性

   * 确保控制器能够正确识别

6. **测试验证**：

   * 测试默认访问（面向大众）

   * 测试内部访问（添加 `?type=internal` 参数）

   * 验证按钮和广告的显示/隐藏逻辑

## 配置文件结构

```json
{
  "_comment": "站点配置文件 - 用于控制广告位和用户类型等功能",
  "version": "1.0.12",
  "features": {
    "advertisement": {
      "enabled": true,
      "position": "right-float"
    },
    "userType": {
      "default": "public",
      "controls": {
        "public": {
          "hideButtons": ["material-self-service", "celebrity-gift-video", "avatar-generator"],
          "showAdvertisement": true
        },
        "internal": {
          "hideButtons": [],
          "showAdvertisement": false
        }
      }
    }
  }
}
```

## 技术要点

* **URL参数解析**：使用 `URLSearchParams` 解析URL中的用户类型参数

* **配置驱动**：所有控制逻辑基于配置文件，便于远程管理

* **向后兼容**：默认行为保持不变，确保现有用户访问不受影响

* **模块化设计**：遵循现有代码结构，保持代码风格一致

* **保持目录结构合理**：新增的js放置在合适的目录里

