<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>SVGA、带通道MP4、Lottie动画在线预览</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Vue 2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <!-- SVGA / Lottie -->
    <script src="https://cdn.jsdelivr.net/npm/svgaplayerweb@2.3.1/build/svga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.7.6/lottie.min.js"></script>

    <style>
      /* ==================== 全局重置 & 基础布局 ==================== */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        font-family: 'Segoe UI', 'Noto Sans SC', -apple-system, BlinkMacSystemFont,
          sans-serif;
        overflow: hidden;
        background-color: #fcfcfc;
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiNlM2UzZTMiLz48L3N2Zz4=');
        background-repeat: repeat;
        background-size: 8px 8px;
        transition: background-color 0.3s, background-image 0.3s;
      }

      body.dark-mode {
        background-color: #1a1a1a;
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiMzMzMzMzMiLz48L3N2Zz4=');
      }

      #app {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      /* ==================== 顶部导航栏 ==================== */

      .header-navbar {
        width: 100%;
        height: 36px;
        background-color: #ffffff;
        border-bottom: 1px solid #e3e3e3;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 24px;
        position: relative;
        z-index: 100;
        transition: background-color 0.3s, border-color 0.3s;
      }

      body.dark-mode .header-navbar {
        background-color: #2a2a2a;
        border-bottom-color: #404040;
      }

      .header-navbar-title {
        font-family: 'Noto Sans SC', sans-serif;
        font-weight: 900;
        font-size: 12px;
        line-height: 1.2;
        color: #2c3e50;
        transition: color 0.3s;
        flex: 1;
        text-align: center;
      }

      body.dark-mode .header-navbar-title {
        color: #e0e0e0;
      }

      .theme-toggle {
        width: 28px;
        height: 28px;
        border: none;
        background: none;
        cursor: pointer;
        outline: none;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.3s;
        flex-shrink: 0;
      }

      .theme-toggle:hover {
        opacity: 0.7;
      }

      .theme-toggle svg {
        width: 20px;
        height: 20px;
        fill: #2c3e50;
        transition: fill 0.3s;
      }

      body.dark-mode .theme-toggle svg {
        fill: #e0e0e0;
      }

      /* Tooltip 气泡 */
      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip .tooltip-text {
        visibility: hidden;
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #ffffff;
        border: 1px solid #e3e3e3;
        border-radius: 8px;
        padding: 8px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 12px;
        line-height: 1.33;
        color: #818181;
        white-space: nowrap;
        box-shadow: 0px 6px 10px 0px rgba(51, 51, 51, 0.2);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s, visibility 0.2s;
      }

      /* 主题切换按钮的 tooltip 在下方 */
      .theme-toggle .tooltip-text {
        bottom: auto;
        top: 125%;
      }

      body.dark-mode .tooltip .tooltip-text {
        background-color: #2a2a2a;
        border-color: #404040;
        color: #999999;
        box-shadow: 0px 6px 10px 0px rgba(0, 0, 0, 0.5);
      }

      .tooltip .tooltip-text::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #ffffff transparent transparent transparent;
      }

      /* 主题切换按钮的箭头在上方 */
      .theme-toggle .tooltip-text::after {
        top: auto;
        bottom: 100%;
        border-color: transparent transparent #ffffff transparent;
      }

      body.dark-mode .tooltip .tooltip-text::after {
        border-color: #2a2a2a transparent transparent transparent;
      }

      body.dark-mode .theme-toggle .tooltip-text::after {
        border-color: transparent transparent #2a2a2a transparent;
      }

      .tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }

      /* ==================== 主页面容器 ==================== */

      .main-page {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
        position: relative;
      }

      /* 播放区域 */
      .viewer-area {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 100px 200px 20px;
        position: relative;
      }

      .viewer-area.drag-hover {
        outline: 2px dashed #5b5b5b;
        outline-offset: -10px;
      }

      .viewer-container {
        width: 100%;
        height: 100%;
        max-width: 1000px;
        max-height: 600px;
        position: relative;
        transform-origin: center center;
        /* transform 动态注入 */
      }

      .viewer-canvas {
        width: 100%;
        height: 100%;
        border-radius: 8px;
        overflow: hidden;
      }

      .viewer-canvas canvas {
        transition: background-color 0.3s;
      }

      /* 空状态覆盖层 */
      .empty-state-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        pointer-events: none;
      }

      .empty-state-icon {
        width: 100px;
        height: 100px;
        margin-bottom: 8px;
      }

      .empty-state-icon svg {
        width: 100%;
        height: 100%;
      }

      .empty-state-text {
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 20px;
        line-height: 1.33;
        color: #5b5b5b;
        text-align: center;
      }

      .empty-state-text em {
        font-style: normal;
        font-weight: 700;
        color: #333333;
      }

      /* ==================== 底部浮层 ==================== */

      .footer-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 140px;
        display: flex;
        flex-direction: row;
        align-items: stretch;
        justify-content: center;
        padding: 10px;
        gap: 10px;
        transition: background-color 0.3s;
      }

      /* 广告位 */
      .ad-slot {
        width: 240px;
        height: 126px;
        background-color: #b1b1b1;
        border-radius: 4px;
        position: absolute;
        right: 10px;
        bottom: 10px;
      }

      /* 底部主控制区 */
      .footer-main {
        flex: 0 1 auto;
        min-width: 1000px;
        max-width: fit-content;
        background-color: #ffffff;
        border: 1px solid #e3e3e3;
        border-radius: 16px;
        box-shadow: 0px 10px 32px 0px rgba(51, 51, 51, 0.2);
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
      }

      body.dark-mode .footer-main {
        background-color: #2a2a2a;
        border-color: #404040;
        box-shadow: 0px 10px 32px 0px rgba(0, 0, 0, 0.5);
      }

      /* 第一行：模块切换 + 清空按钮 */
      .footer-row-tabs {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        height: 28px;
      }

      .footer-tabs {
        display: flex;
        flex-direction: row;
        gap: 16px;
      }

      .tab-btn {
        height: 28px;
        padding: 0 8px;
        border-radius: 8px;
        border: 1px solid #f3f3f3;
        background-color: #ffffff;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 16px;
        line-height: 1.33;
        color: #333333;
        cursor: pointer;
        outline: none;
        transition: all 0.2s;
      }

      body.dark-mode .tab-btn {
        border-color: #404040;
        background-color: #1a1a1a;
        color: #e0e0e0;
      }

      .tab-btn:hover {
        background-color: #fcfcfc;
        border-color: #e3e3e3;
      }

      body.dark-mode .tab-btn:hover {
        background-color: #333333;
        border-color: #555555;
      }

      .tab-btn.is-active {
        background-color: #5b5b5b;
        border-color: #5b5b5b;
        color: #ffffff;
      }

      body.dark-mode .tab-btn.is-active {
        background-color: #666666;
        border-color: #666666;
      }

      .tab-btn.is-active:hover {
        border-color: #333333;
      }

      .tab-btn.is-active:active {
        background-color: #333333;
      }

      .close-btn {
        width: 28px;
        height: 28px;
        border: none;
        background-color: transparent;
        cursor: pointer;
        outline: none;
        position: relative;
      }

      .close-btn::before,
      .close-btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 14px;
        height: 2px;
        background-color: #d3d3d3;
        transition: background-color 0.2s;
      }

      .close-btn::before {
        transform: translate(-50%, -50%) rotate(45deg);
      }

      .close-btn::after {
        transform: translate(-50%, -50%) rotate(-45deg);
      }

      .close-btn:hover::before,
      .close-btn:hover::after {
        background-color: #5b5b5b;
      }

      .close-btn:active::before,
      .close-btn:active::after {
        background-color: #333333;
      }

      /* 第二行：文件信息 */
      .footer-row-info {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 8px;
        height: 22px;
      }

      .info-label {
        width: 70px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.57;
        color: #818181;
        flex-shrink: 0;
        transition: color 0.3s;
      }

      body.dark-mode .info-label {
        color: #999999;
      }

      .info-values {
        flex: 1;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.57;
        color: #333333;
        transition: color 0.3s;
      }

      body.dark-mode .info-values {
        color: #e0e0e0;
      }

      /* 第三行：控制区域 */
      .footer-row-controls {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .controls-left {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 8px;
      }

      .controls-center {
        flex: 1;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .controls-right {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 10px;
      }

      /* 颜色选择按钮 */
      .color-btn {
        width: 28px;
        height: 28px;
        border-radius: 16px;
        border: 1px solid #e3e3e3;
        cursor: pointer;
        outline: none;
        transition: border-color 0.2s;
      }

      .color-btn:hover {
        border-color: #5b5b5b;
      }

      .color-btn.is-active {
        border-color: #333333;
        border-width: 2px;
      }

      /* 播放/暂停按钮 */
      .play-btn {
        width: 28px;
        height: 28px;
        border-radius: 16px;
        border: none;
        background-color: #5b5b5b;
        cursor: pointer;
        outline: none;
        position: relative;
        transition: all 0.2s;
      }

      .play-btn:hover {
        border: 1px solid #333333;
      }

      .play-btn:active {
        background-color: #333333;
      }

      .play-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-40%, -50%);
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 6px 0 6px 10px;
        border-color: transparent transparent transparent #ffffff;
      }

      .play-btn.is-playing::before {
        border: none;
        width: 8px;
        height: 12px;
        background: linear-gradient(
          to right,
          #ffffff 0,
          #ffffff 3px,
          transparent 3px,
          transparent 5px,
          #ffffff 5px,
          #ffffff 8px
        );
        transform: translate(-50%, -50%);
      }

      /* 进度条 */
      .progress-bar {
        width: 200px;
        height: 16px;
        background-color: #f3f3f3;
        border-radius: 16px;
        border: 1px solid #e3e3e3;
        position: relative;
        cursor: pointer;
      }

      .progress-bar:hover {
        border-color: #5b5b5b;
      }

      .progress-fill {
        height: 100%;
        background-color: #409eff;
        border-radius: 16px;
        transition: width 0.1s;
      }

      .progress-text {
        margin-left: 8px;
        width: 60px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.33;
        color: #818181;
        white-space: nowrap;
        text-align: left;
      }

      /* 通用按钮 */
      .btn-primary,
      .btn-secondary {
        height: 28px;
        padding: 0 16px;
        border-radius: 16px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.57;
        text-align: center;
        cursor: pointer;
        outline: none;
        transition: all 0.2s;
        white-space: nowrap;
      }

      .btn-primary {
        background-color: #ffffff;
        border: 1px solid #e3e3e3;
        color: #333333;
      }

      body.dark-mode .btn-primary {
        background-color: #1a1a1a;
        border-color: #404040;
        color: #e0e0e0;
      }

      .btn-primary:hover {
        background-color: #e3e3e3;
        border-color: #5b5b5b;
      }

      body.dark-mode .btn-primary:hover {
        background-color: #333333;
        border-color: #666666;
      }

      .btn-primary:active {
        background-color: #d3d3d3;
        border-color: #333333;
      }

      body.dark-mode .btn-primary:active {
        background-color: #404040;
        border-color: #888888;
      }

      .btn-secondary {
        background-color: #5b5b5b;
        border: 1px solid #5b5b5b;
        color: #ffffff;
      }

      .btn-secondary:hover {
        background-color: #5b5b5b;
        border-color: #333333;
      }

      .btn-secondary:active {
        background-color: #333333;
        border-color: #333333;
      }

      /* 空状态底部提示 */
      .footer-empty-tip {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 4px;
        padding: 16px;
      }

      .footer-empty-tip-main {
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 16px;
        line-height: 1.33;
        color: #000000;
        transition: color 0.3s;
      }

      body.dark-mode .footer-empty-tip-main {
        color: #e0e0e0;
      }

      .footer-empty-tip-sub {
        font-family: 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.33;
        color: #80868c;
        transition: color 0.3s;
      }

      body.dark-mode .footer-empty-tip-sub {
        color: #999999;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <!-- 顶部导航栏 -->
      <div class="header-navbar">
        <div class="header-navbar-title">
          SVGA、带通道MP4、Lottie动画在线预览
        </div>
        <button class="theme-toggle tooltip" @click="toggleTheme">
          <span class="tooltip-text">{{ isDarkMode ? '切换到白天模式' : '切换到暗黑模式' }}</span>
          <svg v-if="!isDarkMode" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <!-- 太阳图标 -->
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg v-else viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <!-- 月亮图标 -->
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>

      <!-- 主页面 -->
      <div class="main-page">
        <!-- 播放区域 -->
        <div
          class="viewer-area"
          :class="{'drag-hover': dropHover}"
          @dragover.prevent="onDragOver"
          @dragleave="onDragLeave"
          @drop.prevent="onDrop"
          @wheel="onWheel"
          @mousedown="onMouseDown"
          @mousemove="onMouseMove"
          @mouseup="onMouseUp"
          @mouseleave="onMouseUp"
        >
          <div
            class="viewer-container"
            :style="viewerContainerStyle"
          >
            <div
              ref="svgaContainer"
              class="viewer-canvas"
            ></div>
          </div>

          <!-- 空状态覆盖层 -->
          <div v-if="isEmpty" class="empty-state-overlay">
            <div class="empty-state-icon">
              <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12.5 4.17L87.5 4.17L87.5 79.17L25 95.83L12.5 79.17L12.5 4.17Z"
                  fill="none"
                  stroke="#D3D3D3"
                  stroke-width="2"
                />
                <path
                  d="M25 79.17L25 95.83M25 79.17L87.5 79.17M25 79.17L12.5 79.17"
                  stroke="#D3D3D3"
                  stroke-width="2"
                />
              </svg>
            </div>
            <div class="empty-state-text">
              将文件拖到此处预览动画,或<em>点击上传</em>
            </div>
          </div>
        </div>

        <!-- 底部浮层 -->
        <div class="footer-bar">
          <!-- 左侧广告位 -->
          <div class="ad-slot"></div>

          <!-- 中间主控制区 -->
          <div class="footer-main">
            <!-- 空状态 -->
            <template v-if="isEmpty">
              <div class="footer-empty-tip">
                <div class="footer-empty-tip-main">请将文件拖到上面</div>
                <div class="footer-empty-tip-sub">
                  支持文件包括：.svga、.json、MP4
                </div>
              </div>
            </template>

            <!-- 非空状态 -->
            <template v-else>
              <!-- 第一行：模块切换 + 清空按钮 -->
              <div class="footer-row-tabs">
                <div class="footer-tabs">
                  <button
                    class="tab-btn"
                    :class="{'is-active': currentModule === 'svga'}"
                    @click="switchModule('svga')"
                  >
                    SVGA
                  </button>
                  <button
                    class="tab-btn tooltip"
                    :class="{'is-active': currentModule === 'yyeva'}"
                    @click="switchModule('yyeva')"
                  >
                    <span class="tooltip-text">还在开发中...</span>
                    YYEVA-MP4
                  </button>
                  <button
                    class="tab-btn tooltip"
                    :class="{'is-active': currentModule === 'lottie'}"
                    @click="switchModule('lottie')"
                  >
                    <span class="tooltip-text">还在开发中...</span>
                    Lottie
                  </button>
                </div>
                <button class="close-btn tooltip" @click="clearAll">
                  <span class="tooltip-text">清除画布预览</span>
                </button>
              </div>

              <!-- 第二行：文件信息 -->
              <div class="footer-row-info">
                <div class="info-label">文件信息：</div>
                <div class="info-values">
                  <span>{{ currentFileInfo.name || '-' }}</span>
                  <span>{{ currentFileInfo.sizeText || '-' }}</span>
                  <span v-if="currentFileInfo.fps">
                    帧率：{{ currentFileInfo.fps }}
                  </span>
                  <span v-if="currentFileInfo.sizeWH">
                    尺寸：{{ currentFileInfo.sizeWH }}
                  </span>
                  <span v-if="currentFileInfo.duration">
                    时长：{{ currentFileInfo.duration }}
                  </span>
                  <span v-if="currentFileInfo.memoryText">
                    内存占用：{{ currentFileInfo.memoryText }}
                  </span>
                </div>
              </div>

              <!-- 第三行：控制区域 -->
              <div class="footer-row-controls">
                <!-- 左侧：颜色选择 -->
                <div class="controls-left">
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'black'}"
                    style="background-color: #000000"
                    @click="bgColorKey = 'black'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'white'}"
                    style="background-color: #ffffff"
                    @click="bgColorKey = 'white'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'pattern'}"
                    style="
                      background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiNlM2UzZTMiLz48L3N2Zz4=');
                      background-repeat: repeat;
                      background-size: 8px 8px;
                    "
                    @click="bgColorKey = 'pattern'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'green'}"
                    style="background-color: #00ff00"
                    @click="bgColorKey = 'green'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'red'}"
                    style="background-color: #df3321"
                    @click="bgColorKey = 'red'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'yellow'}"
                    style="background-color: #f1c40d"
                    @click="bgColorKey = 'yellow'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'blue'}"
                    style="background-color: #00b4ff"
                    @click="bgColorKey = 'blue'"
                  ></button>
                </div>

                <!-- 中间：播放控制 -->
                <div class="controls-center">
                  <button
                    class="play-btn"
                    :class="{'is-playing': isPlaying}"
                    @click="togglePlay"
                  ></button>
                  <div class="progress-bar" @click="onProgressBarClick">
                    <div
                      class="progress-fill"
                      :style="{width: progress + '%'}"
                    ></div>
                  </div>
                  <div class="progress-text">
                    {{ currentFrame }}/{{ totalFrames }}
                  </div>
                </div>

                <!-- 右侧：操作按钮 -->
                <div class="controls-right">
                  <button class="btn-primary tooltip">
                    <span class="tooltip-text">还在开发中...</span>
                    素材图...
                  </button>
                  <button class="btn-primary tooltip">
                    <span class="tooltip-text">还在开发中...</span>
                    导出GIF
                  </button>
                  <button class="btn-secondary tooltip">
                    <span class="tooltip-text">还在开发中...</span>
                    转MP4
                  </button>
                </div>
              </div>
            </template>
          </div>

          <!-- 右侧广告位 -->
          <div class="ad-slot"></div>
        </div>
      </div>
    </div>

    <script>
      new Vue({
        el: '#app',
        data: function () {
          return {
            currentModule: 'svga', // 'svga' | 'yyeva' | 'lottie'
            dropHover: false,

            // 视图操作（缩放 + 平移）
            viewerScale: 1,
            viewerOffsetX: 0,
            viewerOffsetY: 0,
            dragging: false,
            dragStartX: 0,
            dragStartY: 0,
            dragStartOffsetX: 0,
            dragStartOffsetY: 0,

            // 主题模式
            isDarkMode: false,

            // 底色
            bgColorKey: 'pattern', // 'black' | 'white' | 'pattern' | 'green' | 'red' | 'yellow' | 'blue'

            // 播放状态
            isPlaying: false,
            progress: 0, // 0-100
            currentFrame: 0,
            totalFrames: 0,

            // SVGA 状态
            svga: {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: '',
                fps: null,
                sizeWH: '',
                duration: '',
                memoryText: ''
              }
            },

            // YYEVA 状态（阶段1占位）
            yyeva: {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            },

            // Lottie 状态（阶段1占位）
            lottie: {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            },

            // 播放器实例
            svgaPlayer: null,
            svgaParser: null,
            svgaObjectUrl: null
          };
        },
        computed: {
          isEmpty: function () {
            return !this.svga.hasFile && !this.yyeva.hasFile && !this.lottie.hasFile;
          },
          viewerContainerStyle: function () {
            return {
              transform:
                'translate(' +
                this.viewerOffsetX +
                'px,' +
                this.viewerOffsetY +
                'px) scale(' +
                this.viewerScale +
                ')'
            };
          },
          currentBgColor: function () {
            if (this.bgColorKey === 'white') return '#ffffff';
            if (this.bgColorKey === 'green') return '#00ff00';
            if (this.bgColorKey === 'red') return '#df3321';
            if (this.bgColorKey === 'yellow') return '#f1c40d';
            if (this.bgColorKey === 'blue') return '#00b4ff';
            if (this.bgColorKey === 'pattern') {
              return 'transparent';
            }
            return '#000000';
          },
          currentFileInfo: function () {
            if (this.currentModule === 'svga') return this.svga.fileInfo;
            if (this.currentModule === 'yyeva') return this.yyeva.fileInfo;
            if (this.currentModule === 'lottie') return this.lottie.fileInfo;
            return {};
          }
        },
        methods: {
          /* 拖拽上传 */

          onDragOver: function () {
            this.dropHover = true;
          },
          onDragLeave: function () {
            this.dropHover = false;
          },
          onDrop: function (event) {
            this.dropHover = false;
            var files = event.dataTransfer && event.dataTransfer.files;
            if (!files || !files.length) return;
            var file = files[0];
            var name = (file.name || '').toLowerCase();

            if (name.endsWith('.svga')) {
              this.loadSvga(file);
            } else if (name.endsWith('.json')) {
              this.loadLottiePlaceholder(file);
            } else if (name.endsWith('.mp4')) {
              this.loadYyevaPlaceholder(file);
            } else {
              alert('不支持的文件类型，只支持 .svga / .json / .mp4');
            }
          },

          /* 模块切换 */
          switchModule: function (key) {
            this.currentModule = key;
          },

          /* 清空画布 */
          clearAll: function () {
            if (this.svgaPlayer) {
              try {
                this.svgaPlayer.stopAnimation();
                this.svgaPlayer.clear();
              } catch (e) {}
            }
            if (this.svgaObjectUrl) {
              URL.revokeObjectURL(this.svgaObjectUrl);
              this.svgaObjectUrl = null;
            }

            this.svga = {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: '',
                fps: null,
                sizeWH: '',
                duration: '',
                memoryText: ''
              }
            };
            this.yyeva = {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            };
            this.lottie = {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            };

            this.isPlaying = false;
            this.progress = 0;
            this.currentFrame = 0;
            this.totalFrames = 0;
            this.bgColorKey = 'pattern';
          },

          /* SVGA 加载与播放 */

          initSvgaPlayer: function () {
            var container = this.$refs.svgaContainer;
            if (!container) return;
            this.svgaPlayer = new SVGA.Player(container);
            this.svgaParser = new SVGA.Parser();
          },

          loadSvga: function (file) {
            var _this = this;
            this.currentModule = 'svga';

            // 重置视图状态
            this.viewerScale = 1;
            this.viewerOffsetX = 0;
            this.viewerOffsetY = 0;

            this.svga.hasFile = true;
            this.svga.file = file;
            this.svga.fileInfo.name = file.name;
            this.svga.fileInfo.size = file.size;
            this.svga.fileInfo.sizeText = this.formatBytes(file.size);

            this.progress = 0;
            this.currentFrame = 0;
            this.totalFrames = 0;
            this.isPlaying = false;

            var reader = new FileReader();
            reader.onload = function (e) {
              var arrayBuffer = e.target.result;
              var blob = new Blob([arrayBuffer], {
                type: 'application/octet-stream'
              });
              if (_this.svgaObjectUrl) {
                URL.revokeObjectURL(_this.svgaObjectUrl);
              }
              _this.svgaObjectUrl = URL.createObjectURL(blob);

              _this.svgaParser.load(
                _this.svgaObjectUrl,
                function (videoItem) {
                  _this.onSvgaLoaded(videoItem);
                },
                function () {
                  alert('SVGA 解析失败');
                }
              );
            };
            reader.readAsArrayBuffer(file);
          },

          onSvgaLoaded: function (videoItem) {
            if (!this.svgaPlayer) {
              this.initSvgaPlayer();
            }
            if (!this.svgaPlayer) return;

            var _this = this;

            try {
              if (videoItem.videoSize) {
                var w = videoItem.videoSize.width || 0;
                var h = videoItem.videoSize.height || 0;
                _this.svga.fileInfo.sizeWH = w + ' × ' + h;
              }
              _this.svga.fileInfo.fps = videoItem.FPS || videoItem.fps || null;
              var frames =
                videoItem.frames ||
                videoItem.framesCount ||
                videoItem.framesLength ||
                0;
              _this.totalFrames = frames;

              if (_this.svga.fileInfo.fps && frames) {
                var dur = (frames / _this.svga.fileInfo.fps).toFixed(1);
                _this.svga.fileInfo.duration = dur + 's';
              }

              if (w && h && frames) {
                var bytes = w * h * 4 * frames;
                var mb = bytes / 1024 / 1024;
                _this.svga.fileInfo.memoryText = mb.toFixed(2) + 'M';
              }
            } catch (e) {}

            this.svgaPlayer.setVideoItem(videoItem);
            this.svgaPlayer.setContentMode('AspectFit');
            this.svgaPlayer.clearDynamicObjects();

            this.svgaPlayer.onFrame(function (frame) {
              _this.currentFrame = frame;
              if (_this.totalFrames > 0) {
                var p = (frame / (_this.totalFrames - 1)) * 100;
                _this.progress = Math.max(0, Math.min(100, Math.round(p)));
              }
            });

            this.svgaPlayer.onFinished(function () {
              _this.isPlaying = false;
            });

            this.svgaPlayer.startAnimation();
            this.isPlaying = true;

            this.applyCanvasBackground();
          },

          togglePlay: function () {
            if (!this.svgaPlayer || !this.svga.hasFile) return;
            if (this.isPlaying) {
              try {
                this.svgaPlayer.pauseAnimation();
              } catch (e) {}
              this.isPlaying = false;
            } else {
              try {
                var currentPercentage = this.progress / 100;
                this.svgaPlayer.stepToPercentage(currentPercentage, true);
              } catch (e) {}
              this.isPlaying = true;
            }
          },

          onProgressBarClick: function (event) {
            if (!this.svgaPlayer || !this.svga.hasFile) return;
            var rect = event.currentTarget.getBoundingClientRect();
            var x = event.clientX - rect.left;
            var p = x / rect.width;
            p = Math.max(0, Math.min(1, p));
            this.progress = Math.round(p * 100);
            try {
              this.svgaPlayer.stepToPercentage(p, this.isPlaying);
            } catch (e) {}
          },

          /* Lottie / YYEVA 阶段1占位逻辑 */

          loadLottiePlaceholder: function (file) {
            // 重置视图状态
            this.viewerScale = 1;
            this.viewerOffsetX = 0;
            this.viewerOffsetY = 0;

            this.lottie.hasFile = true;
            this.lottie.file = file;
            this.lottie.fileInfo.name = file.name;
            this.lottie.fileInfo.size = file.size;
            this.lottie.fileInfo.sizeText = this.formatBytes(file.size);
            this.currentModule = 'lottie';
            alert('Lottie 模块将在后续阶段实现播放逻辑');
          },

          loadYyevaPlaceholder: function (file) {
            // 重置视图状态
            this.viewerScale = 1;
            this.viewerOffsetX = 0;
            this.viewerOffsetY = 0;

            this.yyeva.hasFile = true;
            this.yyeva.file = file;
            this.yyeva.fileInfo.name = file.name;
            this.yyeva.fileInfo.size = file.size;
            this.yyeva.fileInfo.sizeText = this.formatBytes(file.size);
            this.currentModule = 'yyeva';
            alert('YYEVA MP4 模块将在后续阶段实现播放逻辑');
          },

          /* 主题切换 */

          toggleTheme: function () {
            this.isDarkMode = !this.isDarkMode;
            if (this.isDarkMode) {
              document.body.classList.add('dark-mode');
              localStorage.setItem('theme', 'dark');
            } else {
              document.body.classList.remove('dark-mode');
              localStorage.setItem('theme', 'light');
            }
          },

          /* 缩放 + 平移 */

          onWheel: function (event) {
            if (!event.ctrlKey) return;
            event.preventDefault();
            var delta = event.deltaY || event.wheelDelta;
            var step = delta > 0 ? -0.1 : 0.1;
            var next = this.viewerScale + step;
            if (next < 0.2) next = 0.2;
            if (next > 5) next = 5;
            this.viewerScale = next;
          },

          onMouseDown: function (event) {
            if (event.button !== 1) return;
            event.preventDefault();
            this.dragging = true;
            this.dragStartX = event.clientX;
            this.dragStartY = event.clientY;
            this.dragStartOffsetX = this.viewerOffsetX;
            this.dragStartOffsetY = this.viewerOffsetY;
          },

          onMouseMove: function (event) {
            if (!this.dragging) return;
            var dx = event.clientX - this.dragStartX;
            var dy = event.clientY - this.dragStartY;
            this.viewerOffsetX = this.dragStartOffsetX + dx;
            this.viewerOffsetY = this.dragStartOffsetY + dy;
          },

          onMouseUp: function () {
            this.dragging = false;
          },

          applyCanvasBackground: function () {
            var container = this.$refs.svgaContainer;
            if (!container) return;
            var canvas = container.querySelector('canvas');
            if (canvas) {
              canvas.style.backgroundColor = this.currentBgColor;
            }
          },

          /* 工具方法 */

          formatBytes: function (bytes) {
            if (!bytes && bytes !== 0) return '';
            var kb = bytes / 1024;
            if (kb < 1024) return kb.toFixed(0) + 'kb';
            var mb = kb / 1024;
            return mb.toFixed(2) + 'M';
          }
        },
        watch: {
          currentBgColor: function () {
            this.applyCanvasBackground();
          }
        },
        mounted: function () {
          this.initSvgaPlayer();
          var savedTheme = localStorage.getItem('theme');
          if (savedTheme === 'dark') {
            this.isDarkMode = true;
            document.body.classList.add('dark-mode');
          }
        }
      });
    </script>
  </body>
</html>
