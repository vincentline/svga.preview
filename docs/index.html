<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>SVGA、带通道MP4、Lottie动画在线预览</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- 外部样式表（优先加载） -->
    <link rel="stylesheet" href="styles.css" />
    
    <!-- ===== 所有库统一由 app.js 中的库加载管理系统动态加载 ===== -->
    <!-- Vue.js - 核心框架，优先级最高 -->
    <!-- SVGA播放器 - 核心功能，优先级次之 -->
    <!-- Lottie、Howler - 后台加载 -->
    <!-- Marked - 帮助文档时加载 -->
    <!-- GIF.js - 导出GIF时加载 -->
    <!-- Protobuf、Pako - 导出SVGA时加载 -->
    <!-- FFmpeg - 转MP4时加载 -->
  </head>

  <body>
    <!-- 首屏骨架屏（Vue加载前显示） -->
    <div id="loading-skeleton" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-color, #f5f5f5);
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    ">
      <div style="text-align: center;">
        <div style="
          width: 48px;
          height: 48px;
          margin: 0 auto 16px;
          border: 4px solid #e0e0e0;
          border-top-color: #666;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        "></div>
        <div style="color: #666; font-size: 14px;">加载中...</div>
      </div>
    </div>
    <style>
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
    
    <div id="app">
      <!-- 顶部导航栏 -->
      <div class="header-navbar">
        <a href="avatar_auto.html" class="nav-link">大R头像框自助</a>
        <div class="header-navbar-title">
          SVGA、带通道MP4、Lottie动画在线预览
        </div>
        <button class="theme-toggle tooltip" @click="toggleTheme">
          <span class="tooltip-text">{{ isDarkMode ? '切换到白天模式' : '切换到暗黑模式' }}</span>
          <svg v-if="!isDarkMode" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <!-- 太阳图标 -->
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg v-else viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <!-- 月亮图标 -->
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
        <a href="https://saysth.design/" target="_blank" class="avatar-link">
          <img src="./assets/img/toux.png" alt="" class="avatar-icon">
        </a>
      </div>

      <!-- 库加载进度条 -->
      <div v-if="libraryLoader.currentLib" class="library-loading-indicator">
        <div class="loading-text">正在加载 {{ libraryLoader.currentLib.name }}（{{ libraryLoader.currentLib.progress }}%）</div>
      </div>

      <!-- Help 按钮 -->
      <div class="help-button">
        <img src="./assets/img/help.png" alt="帮助" style="width: 40px; height: 40px;">
        <div class="help-popup" v-html="helpContent"></div>
      </div>

      <!-- 主页面 -->
      <div class="main-page">
        <!-- 播放区域 -->
        <div
          class="viewer-area"
          :class="{'drag-hover': dropHover}"
          @dragover.prevent="onDragOver"
          @dragleave="onDragLeave"
          @drop.prevent="onDrop"
          @wheel="onWheel"
          @mousedown="onMouseDown"
          @mousemove="onMouseMove"
          @mouseup="onMouseUp"
          @mouseleave="onMouseUp"
        >
          <div
            class="viewer-container"
            :style="viewerContainerStyle"
          >
            <div
              ref="svgaContainer"
              class="viewer-canvas"
            ></div>
          </div>

          <!-- 空状态覆盖层 -->
          <div v-if="isEmpty" class="empty-state-overlay">
            <div class="empty-state-icon">
              <div ref="emptyStateSvgaContainer" style="width: 300px; height: 300px;"></div>
            </div>
            <div class="empty-state-text" @click="triggerFileUpload" style="cursor: pointer;">
              将文件拖到此处预览动画,或<em>点击上传</em>
            </div>
            <input
              ref="fileInput"
              type="file"
              accept=".svga,.json,.mp4"
              style="display: none;"
              @change="onFileSelect"
            />
          </div>
        </div>

        <!-- 底部浮层 -->
        <div class="footer-bar">
          <!-- 左侧广告位 -->
          <div class="ad-slot"></div>

          <!-- footer-main 容器（包含主控制区和右上角清空按钮） -->
          <div class="footer-main-wrapper">
            <!-- 右上角清空按钮区域 -->
            <div class="footer-top-actions" v-if="!isEmpty">
              <div class="file-name-box">
                <span class="file-name-label">{{ currentFileInfo.name || '' }}</span>
              </div>
              <button class="clear-canvas-btn" @click="clearAll" title="清空画布">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17 7L7 17" stroke="#333333" stroke-width="1.5" stroke-linecap="round"/>
                  <path d="M7 7L17 17" stroke="#333333" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
            </div>

            <!-- 中间主控制区 -->
            <div class="footer-main" :class="{'footer-main-empty': isEmpty}">
            <!-- 空状态 -->
            <template v-if="isEmpty">
              <div class="footer-empty-tip">
                <div class="footer-empty-tip-main">请将文件拖到上面</div>
                <div class="footer-empty-tip-sub">
                  支持文件包括：.svga、.json、MP4
                </div>
              </div>
            </template>

            <!-- 非空状态 -->
            <template v-else>
              <!-- 第一行：播放控制 + 背景色选择 + 缩放控制 -->
              <div class="footer-row-controls">
                <div class="controls-left">
                  <button
                    class="play-btn"
                    :class="{'is-playing': isPlaying}"
                    @click="togglePlay"
                  ></button>
                  <div class="progress-bar" @click="onProgressBarClick">
                    <div
                      class="progress-fill"
                      :style="{width: progress + '%'}"
                    ></div>
                  </div>
                  <div class="progress-text">
                    {{ currentFrame }}/{{ totalFrames }}
                  </div>
                </div>
                <div class="controls-center">
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'black'}"
                    style="background-color: #000000"
                    @click="bgColorKey = 'black'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'white'}"
                    style="background-color: #ffffff"
                    @click="bgColorKey = 'white'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'green'}"
                    style="background-color: #00ff00"
                    @click="bgColorKey = 'green'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'red'}"
                    style="background-color: #df3321"
                    @click="bgColorKey = 'red'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'yellow'}"
                    style="background-color: #f1c40d"
                    @click="bgColorKey = 'yellow'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'blue'}"
                    style="background-color: #00b4ff"
                    @click="bgColorKey = 'blue'"
                  ></button>
                  <button
                    class="color-btn"
                    :class="{'is-active': bgColorKey === 'pattern'}"
                    style="
                      background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiNlM2UzZTMiLz48L3N2Zz4=');
                      background-repeat: repeat;
                      background-size: 8px 8px;
                    "
                    @click="bgColorKey = 'pattern'"
                  ></button>
                </div>
                <div class="controls-right">
                  <div class="scale-percentage">{{ Math.round(viewerScale * 100) }}%</div>
                  <button 
                    class="zoom-btn" 
                    @click="zoomOut" 
                    title="缩小"
                    :style="{
                      '--zoom-hover-icon': 'url(assets/img/zoom_out_hover.png)',
                      '--zoom-hover-icon-dark': 'url(assets/img/zoom_out_hover_dark.png)'
                    }"
                  >
                    <img :src="zoomOutIcon" class="zoom-icon" />
                  </button>
                  <button 
                    class="zoom-btn" 
                    @click="zoomIn" 
                    title="放大"
                    :style="{
                      '--zoom-hover-icon': 'url(assets/img/zoom_in_hover.png)',
                      '--zoom-hover-icon-dark': 'url(assets/img/zoom_in_hover_dark.png)'
                    }"
                  >
                    <img :src="zoomInIcon" class="zoom-icon" />
                  </button>
                  <button class="reset-scale-btn" @click="resetScale" title="恢复1:1尺寸">
                    <img :src="oneToOneIcon" class="one-to-one-icon" />
                  </button>
                </div>
              </div>

              <!-- 第二行：文件信息 -->
              <div class="footer-row-info">
                <div class="info-item" v-if="currentFileInfo.name">
                  <span class="info-item-label">文件名称：</span>
                  <span class="info-item-value">{{ currentFileInfo.name }}</span>
                </div>
                <div class="info-item" v-if="currentFileInfo.sizeText">
                  <span class="info-item-label">文件大小：</span>
                  <span class="info-item-value">{{ currentFileInfo.sizeText }}</span>
                </div>
                <div class="info-item" v-if="currentFileInfo.fps">
                  <span class="info-item-label">帧率：</span>
                  <span class="info-item-value">{{ currentFileInfo.fps }}</span>
                </div>
                <div class="info-item" v-if="currentFileInfo.sizeWH">
                  <span class="info-item-label">尺寸：</span>
                  <span class="info-item-value">{{ currentFileInfo.sizeWH }}</span>
                </div>
                <div class="info-item" v-if="currentFileInfo.duration">
                  <span class="info-item-label">时长：</span>
                  <span class="info-item-value">{{ currentFileInfo.duration }}</span>
                </div>
                <div class="info-item" v-if="currentFileInfo.memoryText">
                  <span class="info-item-label">内存占用：</span>
                  <span class="info-item-value">{{ currentFileInfo.memoryText }}</span>
                </div>
              </div>

              <!-- 第三行：操作按钮 -->
              <div class="footer-row-tabs">
                <!-- SVGA 模式 -->
                <template v-if="currentModule === 'svga'">
                  <div class="footer-actions-left">
                    <button class="btn-primary" @click="triggerReuploadSVGA" v-if="svga.hasFile">
                      重传SVGA
                    </button>
                  </div>
                  <div class="footer-actions">
                    <button 
                      class="btn-primary"
                      :class="{'tooltip': !svga.hasFile}"
                      :disabled="!svga.hasFile || isExportingGIF"
                      @click="exportGIF"
                    >
                      <span v-if="!svga.hasFile" class="tooltip-text">请先拖入 SVGA 文件</span>
                      {{ isExportingGIF ? '导出中 ' + gifExportProgress + '%' : '导出GIF' }}
                    </button>
                    <button class="btn-primary" @click="openMaterialPanel" v-if="svga.hasFile">
                      素材图替换
                    </button>
                    <button class="btn-primary tooltip" v-else>
                      <span class="tooltip-text">请先拖入 SVGA 文件</span>
                      素材图替换
                    </button>
                    <button 
                      class="btn-secondary"
                      :class="{'tooltip': !svga.hasFile}"
                      :disabled="!svga.hasFile"
                      @click="openMP4Panel"
                    >
                      <span v-if="!svga.hasFile" class="tooltip-text">请先拖入 SVGA 文件</span>
                      转MP4
                    </button>
                  </div>
                </template>
                
                <!-- YYEVA 模式 -->
                <template v-else-if="currentModule === 'yyeva'">
                  <div class="footer-actions-left">
                    <button class="btn-primary" @click="triggerChangePreviewFile">
                      更换预览文件
                    </button>
                    <button class="btn-primary tooltip">
                      <span class="tooltip-text">正在开发中...</span>
                      测试key
                    </button>
                  </div>
                  <div class="footer-actions">
                    <button 
                      class="btn-primary"
                      :class="{'tooltip': !yyeva.hasFile}"
                      :disabled="!yyeva.hasFile || isExportingGIF"
                      @click="exportYyevaGIF"
                    >
                      <span v-if="!yyeva.hasFile" class="tooltip-text">请先拖入 MP4 文件</span>
                      {{ isExportingGIF ? '导出中 ' + gifExportProgress + '%' : '导出GIF' }}
                    </button>
                    <button class="btn-primary tooltip">
                      <span class="tooltip-text">正在开发中...</span>
                      转SVGA
                    </button>
                  </div>
                </template>
                
                <!-- Lottie 模式 -->
                <template v-else>
                  <div class="footer-actions-left">
                    <button class="btn-primary" @click="triggerChangePreviewFile">
                      更换预览文件
                    </button>
                  </div>
                  <div class="footer-actions">
                    <button class="btn-primary tooltip">
                      <span class="tooltip-text">正在开发中...</span>
                      导出GIF
                    </button>
                  </div>
                </template>
              </div>
            </template>
            </div>
          </div>

          <!-- 右侧广告位 -->
          <div class="ad-slot"></div>
        </div>
      </div>

      <!-- 素材弹窗 -->
      <div class="material-overlay" :class="{'show': showMaterialPanel}" @click="closeMaterialPanel"></div>
      <div class="material-panel" :class="{'show': showMaterialPanel}">
        <div class="material-panel-container">
          <!-- 顶部统计信息 -->
          <div class="material-panel-stats">
            <div class="stats-header">素材图替换</div>
            <div class="stats-divider"></div>
            <div class="stats-content">
              <div class="stats-title">图像资源：{{ materialList.length }} 个    内存占用：{{ svga.fileInfo.memoryText }}</div>
              <div class="stats-help">你可以替换素材图片，然后导出新的SVGA。<br>替换后的图片将自动缩放填充至原图尺寸，保持比例居中显示。</div>
            </div>
          </div>
          
          <!-- 搜索框 -->
          <div class="material-search">
            <input 
              type="text" 
              class="material-search-input" 
              placeholder="搜索素材名称..." 
              v-model="materialSearchQuery"
            />
          </div>
          
          <!-- 素材列表 -->
          <div class="material-panel-scroll">
            <div v-if="filteredMaterialList.length === 0" class="material-empty">
              {{ materialSearchQuery ? '未找到匹配的素材' : '未检测到素材图片' }}
            </div>
            <div v-else class="material-list">
              <div 
                v-for="(item, index) in filteredMaterialList" 
                :key="item.imageKey"
                class="material-item"
              >
                <div class="material-thumb" :style="{ backgroundColor: materialThumbBgColor }">
                  <img :src="item.previewUrl" v-if="item.previewUrl" />
                </div>
                <div class="material-info">
                  <div class="material-name-row">
                    <div class="material-name" :title="item.imageKey">{{ item.imageKey }}</div>
                    <button class="material-btn-copy" @click="copyMaterialName(item.imageKey)" title="复制名称">
                      <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="4" width="8" height="8" rx="1" stroke="#666666" stroke-width="1.2" fill="none"/>
                        <rect x="2" y="2" width="8" height="8" rx="1" stroke="#666666" stroke-width="1.2" fill="#ffffff"/>
                      </svg>
                    </button>
                  </div>
                  <div class="material-meta">文件大小：{{ item.fileSizeText }}</div>
                  <div class="material-meta">尺寸：{{ item.sizeText }}</div>
                </div>
                <div class="material-actions">
                  <button class="material-btn-replace" @click="replaceMaterial(index)">
                    <span>替换此图片</span>
                  </button>
                  <button 
                    v-if="item.isReplaced" 
                    class="material-btn-close" 
                    @click="restoreMaterial(index)"
                    title="恢复原图"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <circle cx="12" cy="12" r="6" stroke="#333333" stroke-width="1.3"/>
                      <path d="M14.5 10L17 12.5" stroke="#333333" stroke-width="1.3"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 底部操作按钮 -->
          <div class="material-panel-footer">
            <button class="material-btn-back" @click="closeMaterialPanel" title="关闭">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12 16L6 10L12 4" stroke="#333333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button class="material-btn-export" @click="exportNewSVGA" :disabled="!hasReplacedMaterials">
              导出新SVGA
            </button>
          </div>
        </div>
      </div>

      <!-- MP4转换弹窗 -->
      <div class="mp4-panel" :class="{'show': showMP4Panel}">
        <div class="mp4-panel-container">
          <!-- 标题区 -->
          <div class="mp4-panel-header">
            <h3 class="mp4-panel-title">转换为带通道的MP4格式</h3>
            <div class="mp4-panel-divider"></div>
          </div>
          
          <!-- SVGA信息 -->
          <div class="mp4-info-section">
            <div class="mp4-info-row">SVGA尺寸：{{ svga.fileInfo.sizeWH }}    时长：{{ svga.fileInfo.duration }}</div>
            <div class="mp4-compress-hint">注意：第一次转换需要加载FFmpeg（25M），请耐心等待<br>压缩质量调越低，文件就越小，画面越糊。</div>
          </div>

          <!-- 配置区域 -->
          <div class="mp4-config-section" :class="{disabled: isConvertingMP4}">
            <!-- 遮罩位置 -->
            <div class="mp4-config-item">
              <div class="mp4-config-label">遮罩位置：</div>
              <div class="mp4-select-wrapper" :class="{open: showChannelModeDropdown, disabled: isConvertingMP4}" @click="!isConvertingMP4 && toggleChannelModeDropdown()">
                <div class="mp4-select-text">
                  {{ mp4Config.channelMode === 'color-left-alpha-right' ? '左彩右灰' : '左灰右彩' }}
                </div>
                <div class="mp4-select-icon">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <!-- 下拉菜单 -->
                <div class="mp4-select-dropdown">
                  <div 
                    class="mp4-select-option"
                    :class="{selected: mp4Config.channelMode === 'color-left-alpha-right'}"
                    @click.stop="selectChannelMode('color-left-alpha-right')"
                  >
                    左彩右灰（左侧彩色通道，右侧Alpha通道）
                  </div>
                  <div 
                    class="mp4-select-option"
                    :class="{selected: mp4Config.channelMode === 'alpha-left-color-right'}"
                    @click.stop="selectChannelMode('alpha-left-color-right')"
                  >
                    左灰右彩（左侧Alpha通道，右侧彩色通道）
                  </div>
                </div>
              </div>
            </div>

            <!-- 尺寸 -->
            <div class="mp4-config-item">
              <div class="mp4-config-label">尺寸：</div>
              <div class="mp4-size-container">
                <div class="mp4-size-input-wrapper">
                  <input 
                    type="number" 
                    class="mp4-input" 
                    v-model.number="mp4Config.width" 
                    @input="onMP4WidthChange"
                    :disabled="isConvertingMP4"
                    min="0"
                    max="3000"
                  />
                </div>
                <div class="mp4-size-lock">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.66667 7.33333V5.33333C4.66667 3.86057 5.86057 2.66667 7.33333 2.66667H8.66667C10.1394 2.66667 11.3333 3.86057 11.3333 5.33333V7.33333M5.33333 7.33333H10.6667C11.403 7.33333 12 7.93029 12 8.66667V12C12 12.7364 11.403 13.3333 10.6667 13.3333H5.33333C4.59695 13.3333 4 12.7364 4 12V8.66667C4 7.93029 4.59695 7.33333 5.33333 7.33333Z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="mp4-size-input-wrapper">
                  <input 
                    type="number" 
                    class="mp4-input" 
                    v-model.number="mp4Config.height" 
                    @input="onMP4HeightChange"
                    :disabled="isConvertingMP4"
                    min="0"
                    max="3000"
                  />
                </div>
              </div>
            </div>

            <!-- 压缩到质量 -->
            <div class="mp4-config-item">
              <div class="mp4-config-label">压缩到质量：</div>
              <div class="mp4-value-container">
                <div class="mp4-value-input-wrapper">
                  <input 
                    type="number" 
                    class="mp4-input" 
                    v-model.number="mp4Config.quality" 
                    :disabled="isConvertingMP4"
                    min="1"
                    max="100"
                  />
                </div>
                <div class="mp4-value-unit">%</div>
              </div>
            </div>

            <!-- 帧率修改 -->
            <div class="mp4-config-item">
              <div class="mp4-config-label">帧率修改：</div>
              <div class="mp4-value-container">
                <div class="mp4-value-input-wrapper">
                  <input 
                    type="number" 
                    class="mp4-input" 
                    v-model.number="mp4Config.fps" 
                    :disabled="isConvertingMP4"
                    min="1"
                    max="120"
                  />
                </div>
                <div class="mp4-value-unit">FPS</div>
              </div>
            </div>

            <!-- 静音 -->
            <div class="mp4-config-item">
              <div class="mp4-config-label">静音</div>
              <div class="mp4-mute-toggle" :class="{active: mp4Config.muted, disabled: isConvertingMP4}" @click="!isConvertingMP4 && (mp4Config.muted = !mp4Config.muted)">
                <div class="mp4-mute-toggle-handle"></div>
              </div>
            </div>
          </div>

          <!-- 底部按钮 -->
          <div class="mp4-panel-footer">
            <!-- 返回按钮（转换中变为取消按钮） -->
            <button 
              v-if="!isConvertingMP4"
              class="material-btn-back" 
              @click="closeMP4Panel" 
              title="返回"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12 16L6 10L12 4" stroke="#333333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button 
              v-else
              class="material-btn-back mp4-btn-cancel" 
              @click="cancelMP4Conversion" 
              title="取消转换"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M5 5L15 15M15 5L5 15" stroke="#ff4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            
            <!-- 转换按钮 -->
            <button 
              class="material-btn-export" 
              :class="{'mp4-btn-converting': isConvertingMP4}"
              :data-progress="mp4ConvertProgress"
              :disabled="isConvertingMP4"
              @click="startMP4Conversion"
            >
              <template v-if="isConvertingMP4">
                <span class="mp4-progress-text">{{ mp4ConvertProgress }}%</span>
                <span class="mp4-stage-text">{{ mp4ConvertMessage }}</span>
              </template>
              <template v-else>
                开始转换MP4
              </template>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 隐藏的文件输入框，用于重传SVGA -->
      <input 
        type="file" 
        ref="reuploadSvgaInput"
        accept=".svga" 
        style="display: none;"
        @change="handleReuploadSVGA"
      />
      
      <!-- 隐藏的文件输入框，用于更换预览文件（支持SVGA和MP4） -->
      <input 
        type="file" 
        ref="changePreviewFileInput"
        accept=".svga,.mp4" 
        style="display: none;"
        @change="handleChangePreviewFile"
      />
    </div>

    <!-- 关键库预加载（高优先级） -->
    <script>
      // Vue.js - 核心框架
      (function() {
        var script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js';
        script.onerror = function() {
          // 备用CDN
          var fallback = document.createElement('script');
          fallback.src = 'https://unpkg.com/vue@2.6.14/dist/vue.min.js';
          document.head.appendChild(fallback);
        };
        document.head.appendChild(script);
      })();
      
      // SVGA播放器 - 核心功能
      (function() {
        var script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/svgaplayerweb@2.3.1/build/svga.min.js';
        document.head.appendChild(script);
      })();
    </script>
    
    <!-- 应用主逻辑 -->
    <script src="app.js"></script>
  </body>
</html>
