!function(){"use strict";window.MeeWoo=window.MeeWoo||{},window.MeeWoo.Exporters=window.MeeWoo.Exporters||{};const e={export:async function(e){if(!e.getFrame)throw new Error("缺少 getFrame 回调");var r=e.width||300,t=e.height||300,o=(e.fps,e.onProgress||function(){}),n=e.onError||function(){},a=e.shouldCancel||function(){return!1};try{o(0,"capturing","捕获帧数据...");var i=document.createElement("canvas");i.width=r,i.height=t;var w=i.getContext("2d",{willReadFrequently:!0,alpha:!0}),c=await e.getFrame(0);if(!c)throw new Error("无法获取帧数据");if(0===c.width||0===c.height)throw new Error("获取的帧画布尺寸无效");if(console.log("[WebP导出] 获取到帧数据:",{width:c.width,height:c.height,type:c.constructor.name}),a())throw new Error("导出已取消");o(.3,"converting","转换为WebP格式..."),w.clearRect(0,0,r,t),w.drawImage(c,0,0,r,t);var h=i.toDataURL("image/webp",.9);o(.8,"downloading","生成下载文件...");var d=document.createElement("a");return d.href=h,d.download="export.webp",document.body.appendChild(d),d.click(),document.body.removeChild(d),o(1,"completed","导出完成"),h}catch(e){throw n(e),e}},captureFrames:async function(e){var r=e.width||300,t=e.height||300,o=e.fps||30,n=e.duration||1,a=Math.ceil(n*o),i=[],w=e.seekToFrame,c=e.getCurrentFrameCanvas,h=e.onProgress||function(){},d=e.shouldCancel||function(){return!1};if(!w||!c)throw new Error("缺少必要的帧操作方法");for(var u=0;u<a;u++){if(d())throw new Error("导出已取消");var g=Math.floor(u/o*o);await w(g,o);var s=c();if(!s)throw new Error("无法获取帧画布");var l=document.createElement("canvas");l.width=r,l.height=t,l.getContext("2d").drawImage(s,0,0,r,t);var m=new Image;m.src=l.toDataURL("image/png"),await new Promise(function(e){m.onload=e}),i.push(m),h(u/a*.3,"capturing","捕获帧数据...")}return i}};window.MeeWoo.Exporters.WebPExporter=e}(window);