!function(e){"use strict";window.MeeWoo=window.MeeWoo||{},window.MeeWoo.Services=window.MeeWoo.Services||{};class s{constructor(){this.worker=null,this.isInitialized=!1,this.workerPath="assets/js/service/svga/svga-pixel-worker.js",this.taskId=0,this.pendingTasks=new Map}async init(){if(!this.isInitialized)try{this.worker=new Worker(this.workerPath),this.worker.onmessage=e=>{const s=e.data,r=this.pendingTasks.get(s.id);r&&(this.pendingTasks.delete(s.id),"error"===s.type?r.reject(new Error(s.error)):"progress"===s.type&&r.onProgress?r.onProgress(s.progress/100):"result"===s.type&&r.resolve(s.result))},this.worker.onerror=e=>{console.error("SvgaPixelService Worker error:",e);for(const[s,r]of this.pendingTasks)r.reject(new Error("Worker error: "+e.message));this.pendingTasks.clear()},this.isInitialized=!0,console.log("SvgaPixelService initialized successfully")}catch(e){throw console.error("Failed to initialize SvgaPixelService:",e),e}}async processFrame(e,s,r,i,t,o,n={}){return await this.init(),new Promise((a,d)=>{const h=++this.taskId;this.pendingTasks.set(h,{resolve:a,reject:d,onProgress:n.onProgress}),this.worker.postMessage({id:h,type:"processFrame",data:{frameData:e,alphaPosition:s,width:r,height:i,scaledWidth:t,scaledHeight:o}},e&&e.buffer?[e.buffer]:[])})}async processFrames(e,s,r,i,t,o,n={}){return await this.init(),new Promise((a,d)=>{const h=++this.taskId;this.pendingTasks.set(h,{resolve:a,reject:d,onProgress:n.onProgress});const c=[];e&&Array.isArray(e)&&e.forEach(e=>{e&&e.buffer&&c.push(e.buffer)}),this.worker.postMessage({id:h,type:"processFrames",data:{frames:e,alphaPosition:s,width:r,height:i,scaledWidth:t,scaledHeight:o}},c)})}async clearMemory(){return await this.init(),new Promise((e,s)=>{const r=++this.taskId;this.pendingTasks.set(r,{resolve:e,reject:s}),this.worker.postMessage({id:r,type:"clearMemory",data:{}})})}getStatus(){return{initialized:this.isInitialized,pendingTasks:this.pendingTasks.size}}destroy(){this.worker&&(this.worker.terminate(),this.worker=null),this.pendingTasks.clear(),this.isInitialized=!1}}const r=new s;window.MeeWoo.Services.SvgaPixelService=r,"undefined"!=typeof module&&module.exports?module.exports=s:e.SvgaPixelService=s}("undefined"!=typeof window?window:this);