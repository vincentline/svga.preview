!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};const t={version:"1.0.0",features:{advertisement:{enabled:!1,position:"right-float"}}};e.MeeWoo.Core.SiteConfig=new class{constructor(){this.config=null,this.loaded=!1,this.callbacks=[]}async load(o="https://blog-1258489735.cos.ap-chengdu.myqcloud.com/other/svga_set/site-config.json"){if(this.loaded&&this.config)return this.config;if(["localhost","127.0.0.1","0.0.0.0",""].includes(e.location.hostname))return console.log("[SiteConfig] 本地环境，使用默认配置"),this.config=t,this.loaded=!0,t;try{const e=this.buildCacheBustingUrl(o),t=new AbortController,i=setTimeout(()=>t.abort(),3e3),n=await fetch(e,{method:"GET",signal:t.signal,headers:{Accept:"application/json"}});if(clearTimeout(i),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(!this.validateConfig(s))throw new Error("Invalid config format");return this.config=s,this.loaded=!0,console.log("[SiteConfig] 配置加载成功:",s),s}catch(e){return console.warn("[SiteConfig] 配置加载失败，使用默认配置:",e.message),this.config=t,this.loaded=!0,t}}buildCacheBustingUrl(e){const t=Date.now(),o=e.includes("?")?"&":"?";return`${e}${o}t=${t}`}validateConfig(e){return!(!e||"object"!=typeof e)&&!(!e.version||!e.features)}getFeature(e){return this.config&&this.config.features&&this.config.features[e]||null}isFeatureEnabled(e){const t=this.getFeature(e);return t&&!0===t.enabled}getUserType(){const t=new URLSearchParams(e.location.search).get("type");if(t&&["public","internal"].includes(t))return t;const o=this.getFeature("userType");return o&&o.default||"public"}getUserTypeConfig(){const e=this.getUserType(),t=this.getFeature("userType");return t&&t.controls&&(t.controls[e]||t.controls.public)||{}}isInternalUser(){return"internal"===this.getUserType()}ready(){return this.loaded?Promise.resolve(this.config):new Promise(e=>{this.callbacks.push(e)})}notifyCallbacks(){this.callbacks.forEach(e=>e(this.config)),this.callbacks=[]}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.MeeWoo.Core.SiteConfig.load().then(()=>{e.MeeWoo.Core.SiteConfig.notifyCallbacks()})}):e.MeeWoo.Core.SiteConfig.load().then(()=>{e.MeeWoo.Core.SiteConfig.notifyCallbacks()})}(window);