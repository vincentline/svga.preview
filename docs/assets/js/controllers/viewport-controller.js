!function(t){"use strict";function e(t){this.options=t||{},this.getContentSize=t.getContentSize||function(){return null},this.onViewportChange=t.onViewportChange||function(){},this.scale=1,this.offsetX=0,this.offsetY=0,this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.dragStartOffsetX=0,this.dragStartOffsetY=0,this.headerHeight=t.headerHeight||36,this.footerHeight=t.footerHeight||190,this.defaultScreenHeightRatio=t.screenHeightRatio||.75,this.minScale=t.minScale||.1,this.maxScale=t.maxScale||5,this.zoomStep=t.zoomStep||.1}t.MeeWoo=t.MeeWoo||{},t.MeeWoo.Controllers=t.MeeWoo.Controllers||{},e.prototype.handleMouseDown=function(t){0!==t.button&&1!==t.button||(t.preventDefault(),this.isDragging=!0,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.dragStartOffsetX=this.offsetX,this.dragStartOffsetY=this.offsetY,this.onViewportChange(this.scale,this.offsetX,this.offsetY,this.isDragging))},e.prototype.handleMouseMove=function(t){if(this.isDragging){t.preventDefault();var e=t.clientX-this.dragStartX,i=t.clientY-this.dragStartY,o=this.dragStartOffsetX+e,s=this.dragStartOffsetY+i;this.setOffset(o,s,!0)}},e.prototype.handleMouseUp=function(t){this.isDragging&&(this.isDragging=!1,this.onViewportChange(this.scale,this.offsetX,this.offsetY,this.isDragging))},e.prototype.handleWheel=function(t){t.preventDefault(),(t.deltaY||t.wheelDelta)>0?this.zoomOut():this.zoomIn()},e.prototype.destroy=function(){this.options=null,this.getContentSize=null,this.onViewportChange=null},e.prototype.calculateInitialScale=function(t,e){if(!t||!e)return 1;var i=window.innerHeight*this.defaultScreenHeightRatio/e;return i<this.minScale&&(i=this.minScale),i>this.maxScale&&(i=this.maxScale),i},e.prototype.setScale=function(t,e){t<this.minScale&&(t=this.minScale),t>this.maxScale&&(t=this.maxScale),this.scale=t,!1!==e&&this.onViewportChange(this.scale,this.offsetX,this.offsetY,this.isDragging)},e.prototype.setOffset=function(t,e,i){this.offsetX=t,this.offsetY=e,!1!==i&&this.onViewportChange(this.scale,this.offsetX,this.offsetY,this.isDragging)},e.prototype.centerView=function(){var t=window.innerHeight-this.headerHeight-this.footerHeight,e=this.getContentSize(),i=e?e.height*this.scale:0;this.offsetX=0;var o=this.headerHeight+t/2;this.offsetY=o-i/2,this.onViewportChange(this.scale,this.offsetX,this.offsetY,this.isDragging)},e.prototype.zoomIn=function(){var t=this.scale,e=Math.min(t+this.zoomStep,this.maxScale);this.applyZoomWithCenterPoint(t,e)},e.prototype.zoomOut=function(){var t=this.scale,e=Math.max(t-this.zoomStep,this.minScale);this.applyZoomWithCenterPoint(t,e)},e.prototype.applyZoomWithCenterPoint=function(t,e){var i=this.getContentSize();if(i&&i.height>0){var o=i.height*t,s=i.height*e-o;this.offsetY-=s/2}this.scale=e,this.onViewportChange(this.scale,this.offsetX,this.offsetY,this.isDragging)},e.prototype.resetView=function(){var t=this.getContentSize();if(t){var e=this.calculateInitialScale(t.width,t.height);this.scale=e,this.viewMode="fit-height",this.centerView()}},e.prototype.setScaleTo1=function(){this.scale=1,this.viewMode="1:1",this.centerView()},e.prototype.toggleViewMode=function(){"fit-height"===this.viewMode?this.setScaleTo1():this.resetView()},e.prototype.getViewMode=function(){return this.viewMode},e.prototype.setFooterHeight=function(t){this.footerHeight=t},e.prototype.setHeaderHeight=function(t){this.headerHeight=t},e.prototype.getViewportState=function(){return{scale:this.scale,offsetX:this.offsetX,offsetY:this.offsetY}},e.prototype.destroy=function(){this.options=null,this.getContentSize=null,this.onViewportChange=null},t.MeeWoo=t.MeeWoo||{},t.MeeWoo.Controllers=t.MeeWoo.Controllers||{},t.MeeWoo.Controllers.ViewportController=e}(window);