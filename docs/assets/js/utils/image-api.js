class ImageApi{constructor(){this.baseUrl="https://api.imghlp.com"}checkLogin(){if(!window.authUtils.isLoggedIn())throw new Error("未登录，请先登录");return window.authUtils.getToken()}async request(e,t){const r=this.checkLogin();try{const o=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)});if(!o.ok){if(401===o.status)throw window.authUtils.redirectToLogin(window.location.href),new Error("登录已过期，请重新登录");throw new Error(`API调用失败: ${o.status}`)}const a=await o.json();if(!a.success)throw new Error(a.message||"API调用失败");return a.data}catch(e){throw console.error("API请求失败:",e),e}}async mergeImages(e){return this.request("/merge",{images:e})}async splitImage(e,t){return this.request("/split",{mergedImage:e,positionData:t})}fileToBase64(e){return new Promise((t,r)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=r,o.readAsDataURL(e)})}base64ToBlob(e){const t=e.match(/^data:image\/(\w+);base64,(.+)$/);if(!t)throw new Error("无效的Base64格式");const r=t[1],o=Uint8Array.from(atob(t[2]),e=>e.charCodeAt(0));return new Blob([o],{type:`image/${r}`})}}const imageApi=new ImageApi;window.imageApi=imageApi;